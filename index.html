<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Jewellery POS – Ultra Gold Royal Edition (Updated)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* ------------------------------------------
   GLOBAL GOLD ROYAL THEME
-------------------------------------------*/
:root {
    --gold: #FFD37A;
    --gold-soft: #FFE9B8;
    --gold-hard: #D6A354;
    --dark: #050505;
    --glass: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.12);
}

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(180deg, #000000, #0B0B0B, #101010);
    color: var(--gold-soft);
    min-height: 100vh;
}

/* ------------------------------------------
   HEADER
-------------------------------------------*/
.header {
    padding: 18px 10px;
    text-align: center;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--glass-border);
}

.header-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--gold);
}

.header-tagline {
    font-size: 14px;
    opacity: 0.8;
}

/* ------------------------------------------
   GLASS NAVIGATION BAR
-------------------------------------------*/
.navbar {
    position: sticky;
    top: 0;
    z-index: 50;
    display: flex;
    overflow-x: auto;
    background: rgba(20,20,20,0.55);
    border-bottom: 1px solid var(--glass-border);
    backdrop-filter: blur(10px);
    gap: 6px;
    padding: 10px 6px;
}

.nav-btn {
    flex: 1 1 auto;
    white-space: nowrap;
    padding: 10px 14px;
    font-size: 14px;
    color: var(--gold-soft);
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    border: 1px solid var(--glass-border);
    transition: .25s;
    cursor: pointer;
}

.nav-btn:hover {
    background: rgba(255,255,255,0.12);
    color: var(--gold);
}

.nav-btn.active {
    background: linear-gradient(145deg, var(--gold), var(--gold-hard));
    color: #000;
    font-weight: bold;
    border-color: var(--gold-soft);
    box-shadow: 0 3px 10px rgba(255,175,50,0.4);
    transform: translateY(-2px);
}

/* ------------------------------------------
   UNIVERSAL CARD WITH GOLD FRAME + GLASS
-------------------------------------------*/
.gold-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 14px;
    padding: 18px;
    margin: 14px 0;
    box-shadow: 0 0 18px rgba(255,215,140,0.06);
    backdrop-filter: blur(6px);
}

/* ------------------------------------------
   INPUT (Floating Style)
-------------------------------------------*/
.form-group {
    position: relative;
    margin: 14px 0;
}

.form-input {
    width: 100%;
    padding: 12px 14px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--glass-border);
    color: var(--gold);
    border-radius: 8px;
    transition: .3s ease;
}

.form-input:focus {
    border-color: var(--gold);
    background: rgba(0,0,0,0.4);
    box-shadow: 0 0 8px rgba(255,214,120,0.4);
    outline: none;
}

.form-label {
    position: absolute;
    top: -8px;
    left: 14px;
    background: #000;
    padding: 0 6px;
    font-size: 12px;
    color: var(--gold-soft);
}

/* ------------------------------------------
   GOLD BUTTON
-------------------------------------------*/
.btn-gold {
    background: linear-gradient(140deg, var(--gold), var(--gold-hard));
    color: #000;
    font-weight: 700;
    padding: 12px 20px;
    width: 100%;
    border-radius: 10px;
    margin-top: 8px;
    box-shadow: 0 4px 14px rgba(255,200,100,0.35);
    border: none;
    transition: .25s ease;
    cursor: pointer;
}
.btn-gold:hover {
    background: linear-gradient(140deg, var(--gold-hard), var(--gold));
    transform: translateY(-2px);
}

/* ------------------------------------------
   PAGE HIDE/SHOW
-------------------------------------------*/
.page {
    display: none;
    padding: 18px;
}
.page.active {
    display: block;
}

/* ------------------------------------------
   TABLE GOLD THEME
-------------------------------------------*/
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background: rgba(255,255,255,0.04);
    border-radius: 10px;
    overflow: hidden;
}
th {
    background: rgba(255,255,255,0.07);
    padding: 10px;
    color: var(--gold);
    font-size: 13px;
    text-align: left;
}
td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    color: var(--gold-soft);
    font-size: 13px;
}

/* ------------------------------------------
   MODAL (GLASS)
-------------------------------------------*/
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 14px;
    z-index: 100;
}
.modal-card {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 14px;
    padding: 20px;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 0 24px rgba(255,210,120,0.2);
}
</style>

</head>

<body>

<div class="header">
    <h1 class="header-title"><i class="fa-solid fa-gem mr-2"></i> জুয়েলারি POS সিস্টেম</h1>
    <p class="header-tagline">Ultra Gold Royal Premium Edition</p>
</div>

<div class="navbar">
    <button class="nav-btn active" onclick="showPage('dashboard', this)">ড্যাশবোর্ড</button>
    <button class="nav-btn" onclick="showPage('purchase', this)">ক্রয়</button>
    <button class="nav-btn" onclick="showPage('sale', this)">বিক্রয়</button>
    <button class="nav-btn" onclick="showPage('mortgage', this)">বন্ধক</button>
    <button class="nav-btn" onclick="showPage('cash', this)">নগদ</button>
    <button class="nav-btn" onclick="showPage('reports', this)">রিপোর্ট</button>
    <button class="nav-btn" onclick="showPage('party', this)">পার্টি</button>
</div>

<!-- PART–1 END -->
<!-- PART–2 START -->
<script type="module">

/* ------------------------------------------
   FIREBASE IMPORTS
------------------------------------------- */

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import {
    getFirestore,
    doc,
    setDoc,
    addDoc,
    getDoc,
    updateDoc,
    onSnapshot,
    deleteDoc,
    collection,
    query,
    where,
    orderBy,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

/* ------------------------------------------
   FIREBASE CONFIG (YOUR REAL PROJECT)
------------------------------------------- */

const firebaseConfig = {
  apiKey: "AIzaSyDc6By4_9Y5skuN77ma1pLJY7i9yitn0RI",
  authDomain: "bodhuboronpos.firebaseapp.com",
  projectId: "bodhuboronpos",
  storageBucket: "bodhuboronpos.firebasestorage.app",
  messagingSenderId: "1011193405688",
  appId: "1:1011193405688:web:ffbb0955a4a388fc42db0d",
  measurementId: "G-1Y3P8XQ734"
};

/* ------------------------------------------
   FIREBASE INITIALIZATION
------------------------------------------- */
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);

/* ------------------------------------------
   WEIGHT CONSTANTS
------------------------------------------- */
const GRAMS_PER_VORI = 11.664;
const ANA_PER_VORI = 16;
const ROTI_PER_ANA = 4;
const POINT_PER_ROTI = 6;
const POINT_PER_VORI = ANA_PER_VORI * ROTI_PER_ANA * POINT_PER_ROTI;

/* ------------------------------------------
   WEIGHT CALCULATIONS
------------------------------------------- */
function voriToDecimal(v, a, r, p) {
    v = parseFloat(v) || 0;
    a = parseFloat(a) || 0;
    r = parseFloat(r) || 0;
    p = parseFloat(p) || 0;

    let totalPoints =
        v * POINT_PER_VORI +
        a * ROTI_PER_ANA * POINT_PER_ROTI +
        r * POINT_PER_ROTI +
        p;

    return totalPoints / POINT_PER_VORI;
}

function voriToGrams(v, a, r, p) {
    return voriToDecimal(v, a, r, p) * GRAMS_PER_VORI;
}

/* ------------------------------------------
   FORMAT CURRENCY
------------------------------------------- */
function formatCurrency(amount) {
    return "৳ " + (amount || 0).toLocaleString("bn-BD");
}

/* ------------------------------------------
   MESSAGE BOX (Toast)
------------------------------------------- */
window.showMessage = function (msg, type="success") {
    const box = document.getElementById("message-box");
    box.textContent = msg;

    box.style.background = type === "success" ? "#0a9b6a" : "#d9534f";
    box.style.display = "block";
    box.style.transform = "translateX(0)";

    setTimeout(() => {
        box.style.transform = "translateX(120%)";
        setTimeout(() => (box.style.display = "none"), 300);
    }, 2500);
};
/* ------------------------------------------
   REAL-TIME LISTENERS
------------------------------------------- */

function startListeners() {

    // GOLD RATE
    onSnapshot(doc(db, "settings", "gold_rate"), (snap) => {
        if (snap.exists()) {
            const rate = snap.data().rate || 0;
            document.getElementById("current-gold-rate").textContent =
                "বর্তমান রেট: " + formatCurrency(rate);
            window.currentGoldRate = rate;
        }
    });

    // TRANSACTIONS
    const q = query(
        collection(db, "transactions"),
        orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snap) => {
        window.allTransactions = [];
        snap.forEach((d) => window.allTransactions.push(d.data()));
        updateDashboard();
        updateRecentTransactions();
        updateCashTable();
    });

    // MORTGAGE
    const mq = query(collection(db, "mortgages"));
    onSnapshot(mq, (snap) => {
        updateMortgageTable(snap);
    });
}

/* ------------------------------------------
   ADD TRANSACTION TO FIRESTORE
------------------------------------------- */
async function addTransaction(data) {
    await addDoc(collection(db, "transactions"), {
        ...data,
        timestamp: serverTimestamp(),
    });
}

/* ------------------------------------------
   UPDATE DASHBOARD
------------------------------------------- */
function updateDashboard() {
    let totalInvestment = 0,
        totalExpense = 0,
        totalGrams = 0,
        totalInterest = 0;

    window.allTransactions.forEach((t) => {
        if (t.type === "Investment") totalInvestment += t.amount;
        if (t.type === "Expense") totalExpense += t.amount;

        if (t.type === "Purchase") totalGrams += t.grams;
        if (t.type === "Sale") totalGrams -= t.grams;

        if (t.type === "Redeem") totalInterest += t.interest;
    });

    document.getElementById("total-investment").textContent =
        formatCurrency(totalInvestment);

    document.getElementById("total-expense").textContent =
        formatCurrency(totalExpense);

    document.getElementById("stock-grams").textContent =
        totalGrams.toFixed(3) + " gm";

    document.getElementById("stock-vori").textContent =
        (totalGrams / GRAMS_PER_VORI).toFixed(3) + " ভরি";

    document.getElementById("stock-market-value").textContent =
        formatCurrency(
            (totalGrams / GRAMS_PER_VORI) * (window.currentGoldRate || 0)
        );
}

/* ------------------------------------------
   RECENT TRANSACTIONS
------------------------------------------- */
function updateRecentTransactions() {
    const body = document.getElementById("recent-transactions-body");
    body.innerHTML = "";

    window.allTransactions.slice(0, 10).forEach((t) => {
        body.innerHTML += `
            <tr>
                <td>${new Date(t.timestamp?.toDate()).toLocaleDateString("bn-BD")}</td>
                <td>${t.type_bn}</td>
                <td>${formatCurrency(t.amount)}</td>
                <td>${t.description}</td>
            </tr>
        `;
    });
}

/* ------------------------------------------
   CASH TABLE UPDATE
------------------------------------------- */
function updateCashTable() {
    const body = document.getElementById("cash-list-body");
    body.innerHTML = "";

    window.allTransactions
        .filter((t) => ["Investment", "Expense"].includes(t.type))
        .forEach((t) => {
            body.innerHTML += `
                <tr>
                    <td>${new Date(t.timestamp?.toDate()).toLocaleDateString("bn-BD")}</td>
                    <td>${t.type_bn}</td>
                    <td>${formatCurrency(t.amount)}</td>
                    <td>${t.description}</td>
                </tr>
            `;
        });
}

/* ------------------------------------------
   PURCHASE FORM SUBMIT
------------------------------------------- */
document.getElementById("purchase-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    let V = purchase-vori.value,
        A = purchase-ana.value,
        R = purchase-roti.value,
        P = purchase-point.value;

    let grams = voriToGrams(V, A, R, P);
    let vori = voriToDecimal(V, A, R, P);

    let amount =
        vori * parseFloat(purchase-price-per-vori.value) +
        parseFloat(purchase-making-charge.value);

    await addTransaction({
        type: "Purchase",
        type_bn: "ক্রয়",
        grams,
        amount: Math.round(amount),
        description: `ক্রয়: ${vori.toFixed(2)} ভরি`,
        supplier: purchase-supplier.value,
    });

    showMessage("ক্রয় সংরক্ষণ হয়েছে");
});

/* ------------------------------------------
   SALE FORM SUBMIT
------------------------------------------- */
document.getElementById("sale-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    let V = sale-vori.value,
        A = sale-ana.value,
        R = sale-roti.value,
        P = sale-point.value;

    let grams = voriToGrams(V, A, R, P);
    let vori = voriToDecimal(V, A, R, P);

    let amount =
        vori * parseFloat(sale-price-per-vori.value) +
        parseFloat(sale-charge-profit.value);

    await addTransaction({
        type: "Sale",
        type_bn: "বিক্রয়",
        grams,
        amount: Math.round(amount),
        description: `বিক্রয়: ${vori.toFixed(2)} ভরি`,
        customer: sale-customer.value,
        phone: sale-phone.value,
    });

    showMessage("বিক্রয় সংরক্ষণ হয়েছে");
});

/* ------------------------------------------
   CASH FORM SUBMIT
------------------------------------------- */
document
    .getElementById("cash-transaction-form")
    .addEventListener("submit", async (e) => {
        e.preventDefault();

        await addTransaction({
            type: cash-type.value,
            type_bn: cash-type.value === "Investment" ? "বিনিয়োগ" : "খরচ",
            amount: parseFloat(cash-amount.value),
            description: cash-description.value,
        });

        showMessage("নগদ লেনদেন সংরক্ষণ হয়েছে");
    });

/* ------------------------------------------
   PAGE SWITCHER
------------------------------------------- */
window.showPage = function (id, btn) {
    document.querySelectorAll(".page").forEach((p) => (p.style.display = "none"));
    document.getElementById(id).style.display = "block";

    document.querySelectorAll(".nav-btn").forEach((b) =>
        b.classList.remove("active")
    );
    btn.classList.add("active");
};

/* ------------------------------------------
   INIT APP
------------------------------------------- */
window.onload = function () {
    startListeners();
    showPage("dashboard", document.querySelector(".nav-btn"));
};

</script>

</body>
</html>
