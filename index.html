<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Budh Baran Jewellers ‚Äì POS V12 (‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶®‡¶ø‡¶ï‡¶æ‡¶∂)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ICONS & Tailwind -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* Custom Styles for Gold Theme */
:root {
    --gold: #ffdb95;
    --dark: #0a0a0a;
    --medium-dark: #1f1f1f;
    --light-gold: #ffe6a8;
}

body{
    margin:0;
    background: var(--dark);
    font-family:'Inter', sans-serif;
    color: var(--gold);
}

/* HEADER */
.header{
    text-align:center;
    padding:20px 10px;
    background: var(--dark);
    border-bottom:1px solid #333;
}
.logo{
    width:90px;height:90px;border-radius:50%;
    border:3px solid var(--gold);
    margin-bottom:10px;
}
.title{
    font-size:28px;
    font-weight:700;
    color: var(--gold);
}
.tagline{
    font-style:italic;
    font-size:13px;
    color: var(--light-gold);
}

/* SECTION */
.page{
    display:none;
    padding:15px;
    padding-bottom:90px;
}
#home{display:block;}

.section{
    background: var(--medium-dark);
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
    border: 1px solid #333;
}

h2{
    font-size: 1.5rem;
    color: var(--light-gold);
    border-bottom: 2px solid #333;
    padding-bottom: 5px;
    margin-top: 0;
    margin-bottom: 15px;
}

/* INPUT FORM STYLES */
.form-group{
    margin-bottom: 10px;
}
.form-group label{
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--light-gold);
}
.form-group input, .form-group select, .form-group textarea{
    width: 100%;
    padding: 10px;
    background: #000;
    border: 1px solid #444;
    border-radius: 4px;
    color: var(--gold);
    box-sizing: border-box;
}

.primary-btn {
    background: #ffc84d; /* Brighter gold for button */
    color: #000;
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s, transform 0.1s;
    width: 100%;
}
.primary-btn:hover {
    background: #ffdb95;
}
.primary-btn:active {
    transform: scale(0.99);
}

/* TABLE STYLES */
.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
}
.data-table th, .data-table td {
    padding: 10px;
    border: 1px solid #333;
    text-align: left;
}
.data-table th {
    background: #2a2a2a;
    color: var(--gold);
    font-weight: 700;
    position: sticky;
    top: 0;
}
.data-table tbody tr:nth-child(even) {
    background: #181818;
}
.data-table tbody tr:hover {
    background: #222;
}

/* NAVIGATION */
.nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-around;
    background: #111;
    border-top: 1px solid #333;
    padding: 5px 0;
    z-index: 1000;
}
.nav button {
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    padding: 8px 5px;
    font-size: 12px;
    transition: color 0.2s, background 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    flex: 1;
}
.nav button i {
    font-size: 18px;
}
.nav button.active {
    color: var(--gold);
}
.nav button:not(.active):hover {
    color: #aaa;
}

/* Report Cards */
.report-card {
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 10px;
    font-size: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 5px solid;
}
.card-value {
    font-size: 1.5rem;
    font-weight: bold;
}

/* Custom Admin Panel Style */
#admin-panel {
    background: rgba(0, 100, 150, 0.2);
    border: 1px solid #0077b6;
}
</style>
</head>
<body>

<header class="header">
    <img src="https://placehold.co/90x90/ffdb95/0a0a0a?text=BB" alt="Logo" class="logo">
    <h1 class="title">‡¶¨‡ßÅ‡¶ß ‡¶¨‡¶∞‡¶£ ‡¶ú‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤‡¶æ‡¶∞‡ßç‡¶∏</h1>
    <p class="tagline">‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶®‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶è‡¶¨‡¶Ç ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</p>
</header>

<!-- =================== HOME =================== -->
<div id="home" class="page">
    <div class="section">
        <h2>üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≠‡¶ø‡¶â</h2>
        <div class="text-xs mb-3 p-2 rounded bg-gray-900 border border-gray-700">
            <p id="auth-status" class="text-red-400">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            <p class="mt-1 flex items-center justify-between">
                ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: <span id="user-id-display" class="font-mono text-gray-500 text-[10px] ml-2"></span>
                <span id="user-role-display" class="font-bold px-2 py-1 rounded-full text-xs"></span>
            </p>
        </div>
        
        <!-- NEW ADMIN/MANAGER INFO PANEL -->
        <div id="admin-panel" class="section hidden">
            <h3 class="text-lg font-semibold mb-2 text-blue-300">‚öôÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®</h3>
            <p class="text-sm text-blue-400 mb-3">‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡¶∞‡¶æ ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
            <div class="form-group">
                <label for="new-manager-id">‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞/‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <div class="flex gap-2">
                    <input type="text" id="new-manager-id" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®" class="flex-grow">
                    <button onclick="addManagerId()" class="bg-blue-600 hover:bg-blue-500 text-white p-2 rounded-lg font-bold w-1/3">‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
            <p class="text-xs text-gray-400 mt-2">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: <span id="manager-ids-list" class="font-mono text-[10px]"></span></p>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
            <div class="p-4 bg-green-900/50 rounded-lg border border-green-700">
                <p class="text-sm">‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ (‡¶®‡¶ó‡¶¶)</p>
                <p class="text-2xl font-bold mt-1" id="total-cash-display">‡ß≥ 0.00</p>
            </div>
            <div class="p-4 bg-yellow-900/50 rounded-lg border border-yellow-700">
                <p class="text-sm">‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</p>
                <p class="text-2xl font-bold mt-1" id="total-stock-value">‡ß≥ 0.00</p>
            </div>
            <div class="p-4 bg-blue-900/50 rounded-lg border border-blue-700">
                <p class="text-sm">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</p>
                <p class="text-2xl font-bold mt-1" id="total-order-due">‡ß≥ 0.00</p>
            </div>
            <div class="p-4 bg-red-900/50 rounded-lg border border-red-700">
                <p class="text-sm">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶®‡ßç‡¶ß‡¶ï (Outstanding Mortgage)</p>
                <p class="text-2xl font-bold mt-1" id="total-mortgage-value">‡ß≥ 0.00</p>
            </div>
        </div>
        
        <div class="section mt-4">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶®‡¶ó‡¶¶ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® (Cash Ledger)</h3>
            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                            <th>‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞</th>
                            <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</th>
                        </tr>
                    </thead>
                    <tbody id="cash-ledger-body">
                        <!-- Cash Ledger Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!-- =================== SALES (‡¶®‡¶ó‡¶¶ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®) =================== -->
<div id="sales" class="page">
    <div class="section">
        <h2>üí∏ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶ó‡¶¶ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® (Cash Transaction)</h2>
        <p class="text-sm text-gray-400">‡¶∏‡ßç‡¶ü‡¶ï ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º, ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ó‡¶¶ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶ø/‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        
        <form id="cash-transaction-form" class="bg-gray-800 p-4 rounded-lg mt-4 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>
            
            <div class="form-group">
                <label for="transaction-type">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞</label>
                <select id="transaction-type" required>
                    <option value="inflow">‡¶®‡¶ó‡¶¶ ‡¶Ü‡¶ó‡¶Æ‡¶® (Cash In)</option>
                    <option value="outflow">‡¶®‡¶ó‡¶¶ ‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶ó‡¶Æ‡¶® (Cash Out)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="transaction-amount">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
                <input type="number" step="1" id="transaction-amount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ü‡¶æ‡¶ï‡¶æ)" required>
            </div>
            
            <div class="form-group">
                <label for="transaction-description">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                <textarea id="transaction-description" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶ö‡ßÅ‡¶°‡¶º‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º, ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶≠‡¶æ‡¶°‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ó‡ßç‡¶∞‡¶π‡¶£..." required></textarea>
            </div>
            
            <div class="form-group">
                <label for="customer-name">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï/‡¶™‡¶ï‡ßç‡¶∑ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                <input type="text" id="customer-name" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ/‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶™‡¶ï‡ßç‡¶∑">
            </div>
            
            <div class="form-group mt-3">
                <button type="submit" class="primary-btn">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </form>
        
    </div>
</div>

<!-- =================== STOCK (‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü ‡¶ì ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø) =================== -->
<div id="stock" class="page">
    <div class="section">
        <h2>‚ú® ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶ì ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡¶∏‡ßç‡¶ü‡¶ï)</h2>
        <p class="text-sm text-gray-400 mb-4">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>

        <!-- Stock Input Form -->
        <form id="stock-form" class="bg-gray-800 p-4 rounded-lg mb-6 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü)</h3>

            <div class="grid grid-cols-2 gap-3">
                <div class="form-group">
                    <label for="item-name">‡¶®‡¶æ‡¶Æ/‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                    <input type="text" id="item-name" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ö‡ßÅ‡¶°‡¶º‡¶ø, ‡¶Ü‡¶Ç‡¶ü‡¶ø, ‡¶ö‡ßá‡¶®" required>
                </div>
                <div class="form-group">
                    <label for="gold-weight">‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶ì‡¶ú‡¶® (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</label>
                    <input type="number" step="0.01" id="gold-weight" placeholder="10.50" required>
                </div>
                <div class="form-group">
                    <label for="purity">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü</label>
                    <select id="purity" required>
                        <option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶®</option>
                        <option value="24">24K</option>
                        <option value="22">22K</option>
                        <option value="21">21K</option>
                        <option value="18">18K</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="purchase-price">‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥)</label>
                    <input type="number" step="1" id="purchase-price" placeholder="‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö" required>
                </div>
            </div>
            <div class="form-group mt-3">
                <button type="submit" class="primary-btn">‡¶∏‡ßç‡¶ü‡¶ï‡ßá ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </form>

        <!-- Stock List -->
        <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø</h3>
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡¶®‡¶æ‡¶Æ</th>
                        <th>‡¶ì‡¶ú‡¶® (gm)</th>
                        <th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü</th>
                        <th>‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥)</th>
                        <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                    </tr>
                </thead>
                <tbody id="stock-list-body">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =================== MORTGAGE (‡¶¨‡¶®‡ßç‡¶ß‡¶ï) =================== -->
<div id="mortgage" class="page">
    <div class="section">
        <h2>ü§ù ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶ó‡ßç‡¶∞‡¶π‡¶£ (New Mortgage)</h2>
        <p class="text-sm text-gray-400">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ ‡¶•‡ßá‡¶ï‡ßá ‡¶ó‡¶π‡¶®‡¶æ ‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶∞‡ßá‡¶ñ‡ßá ‡¶ã‡¶£ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

        <!-- Mortgage Input Form -->
        <form id="mortgage-form" class="bg-gray-800 p-4 rounded-lg mt-4 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶¨‡¶®‡ßç‡¶ß‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</h3>

            <div class="form-group">
                <label for="mortgage-customer-name">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                <input type="text" id="mortgage-customer-name" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ" required>
            </div>
            <div class="form-group">
                <label for="mortgage-item-description">‡¶¨‡¶®‡ßç‡¶ß‡¶ï‡ßá‡¶∞ ‡¶ó‡¶π‡¶®‡¶æ (‡¶¨‡¶ø‡¶¨‡¶∞‡¶£)</label>
                <input type="text" id="mortgage-item-description" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡ßß‡¶ü‡¶ø ‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶π‡¶æ‡¶∞, ‡ß®‡¶ü‡¶æ ‡¶¨‡¶æ‡¶≤‡¶æ" required>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="form-group">
                    <label for="mortgage-gold-weight">‡¶ì‡¶ú‡¶® (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</label>
                    <input type="number" step="0.01" id="mortgage-gold-weight" placeholder="15.00" required>
                </div>
                <div class="form-group">
                    <label for="mortgage-purity">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü</label>
                    <select id="mortgage-purity" required>
                        <option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶®</option>
                        <option value="24">24K</option>
                        <option value="22">22K</option>
                        <option value="21">21K</option>
                        <option value="18">18K</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="mortgage-principal-amount">‡¶ã‡¶£‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
                <input type="number" step="1" id="mortgage-principal-amount" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 50000" required>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div class="form-group">
                    <label for="mortgage-interest-rate">‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (% ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï)</label>
                    <input type="number" step="0.1" id="mortgage-interest-rate" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 2.0" required>
                </div>
                <div class="form-group">
                    <label for="mortgage-term-months">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ (‡¶Æ‡¶æ‡¶∏)</label>
                    <input type="number" step="1" id="mortgage-term-months" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 6" required>
                </div>
            </div>

            <div class="form-group mt-3">
                <button type="submit" class="primary-btn bg-red-600 hover:bg-red-500">‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ì ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</button>
            </div>
        </form>
    </div>

    <div class="section">
        <h2>üìú ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                        <th>‡¶ì‡¶ú‡¶® (gm)</th>
                        <th>‡¶ã‡¶£ (‡ß≥)</th>
                        <th>‡¶∏‡ßÅ‡¶¶ (%)</th>
                        <th>‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø</th>
                        <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                    </tr>
                </thead>
                <tbody id="mortgage-list-body">
                    <!-- Mortgage Data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =================== ORDERS (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ) =================== -->
<div id="orders" class="page">
    <div class="section">
        <h2>üõçÔ∏è ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ (Custom Order)</h2>
        <p class="text-sm text-gray-400">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡¶π‡¶®‡¶æ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

        <!-- New Order Form -->
        <form id="order-form" class="bg-gray-800 p-4 rounded-lg mt-4 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</h3>

            <div class="form-group">
                <label for="order-customer-name">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                <input type="text" id="order-customer-name" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ" required>
            </div>
            <div class="form-group">
                <label for="order-item-description">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ</label>
                <input type="text" id="order-item-description" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶®‡¶ï‡¶∂‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶∏‡ßã‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ç‡¶ü‡¶ø" required>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="form-group">
                    <label for="order-required-gold">‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶∏‡ßã‡¶®‡¶æ (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</label>
                    <input type="number" step="0.01" id="order-required-gold" placeholder="5.50" required>
                </div>
                <div class="form-group">
                    <label for="order-purity">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü</label>
                    <select id="order-purity" required>
                        <option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶®</option>
                        <option value="24">24K</option>
                        <option value="22">22K</option>
                        <option value="21">21K</option>
                        <option value="18">18K</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="form-group">
                    <label for="order-making-charge">‡¶Æ‡¶ú‡ßÅ‡¶∞‡¶ø/‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã‡¶∞ ‡¶ñ‡¶∞‡¶ö (‡ß≥)</label>
                    <input type="number" step="1" id="order-making-charge" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 5000" required>
                </div>
                <div class="form-group">
                    <label for="order-advance-payment">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡ß≥)</label>
                    <input type="number" step="1" id="order-advance-payment" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 10000" value="0">
                </div>
            </div>
            
            <div class="form-group">
                <label for="order-delivery-date">‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                <input type="date" id="order-delivery-date" required>
            </div>

            <div class="form-group mt-3">
                <button type="submit" class="primary-btn bg-blue-600 hover:bg-blue-500">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶®‡¶ø‡¶®</button>
            </div>
        </form>
    </div>

    <div class="section">
        <h2>üìù ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                        <th>‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ</th>
                        <th>‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶∏‡ßã‡¶®‡¶æ (gm)</th>
                        <th>‡¶Æ‡¶ú‡ßÅ‡¶∞‡¶ø (‡ß≥)</th>
                        <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ (‡ß≥)</th>
                        <th>‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø</th>
                        <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                    </tr>
                </thead>
                <tbody id="order-list-body">
                    <tr><td colspan="7" class="text-center text-gray-500">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =================== CUSTOMERS =================== -->
<div id="customers" class="page">
    <div class="section">
        <h2>üë• ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h2>
        <p class="text-sm text-gray-400">‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>

        <!-- Add Customer Form -->
        <form id="customer-form" class="bg-gray-800 p-4 rounded-lg mb-6 border border-gray-700">
            <h3 class="text-lg font-semibold mb-3 text-light-gold">‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>

            <div class="form-group">
                <label for="customer-name-input">‡¶®‡¶æ‡¶Æ</label>
                <input type="text" id="customer-name-input" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ" required>
            </div>
            <div class="form-group">
                <label for="customer-phone-input">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                <input type="tel" id="customer-phone-input" placeholder="01XXXXXXXXX" required>
            </div>
            <div class="form-group">
                <label for="customer-address-input">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ (‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§)</label>
                <textarea id="customer-address-input" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ/‡¶∂‡¶π‡¶∞, ‡¶ú‡ßá‡¶≤‡¶æ"></textarea>
            </div>

            <div class="form-group mt-3">
                <button type="submit" class="primary-btn">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </form>

        <!-- Customer List -->
        <h3 class="text-lg font-semibold mb-3 mt-5 text-light-gold border-b border-gray-700 pb-1">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡¶®‡¶æ‡¶Æ</th>
                        <th>‡¶´‡ßã‡¶®</th>
                        <th>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th>
                        <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                    </tr>
                </thead>
                <tbody id="customer-list-body">
                    <tr><td colspan="4" class="text-center text-gray-500">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =================== REPORTS =================== -->
<div id="reports" class="page">
    <div class="section">
        <h2>üìÖ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ì ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ (A to Z ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨)</h2>
        <p class="text-sm text-gray-400 mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>

        <!-- Financial Summary -->
        <h3 class="text-lg font-semibold mb-3 text-light-gold border-b border-gray-700 pb-1">‡ßß. ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="report-card" style="border-color: #38a169; background-color: rgba(56, 161, 105, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (‡¶®‡¶ó‡¶¶)</span>
                <span class="card-value" id="report-total-cash">‡ß≥ 0.00</span>
            </div>
            <div class="report-card" style="border-color: #ecc94b; background-color: rgba(236, 201, 75, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
                <span class="card-value" id="report-total-stock">‡ß≥ 0.00</span>
            </div>
             <div class="report-card" style="border-color: #3182ce; background-color: rgba(49, 130, 206, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</span>
                <span class="card-value" id="report-total-order-due">‡ß≥ 0.00</span>
            </div>
            <div class="report-card" style="border-color: #e53e3e; background-color: rgba(229, 62, 62, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ (‡¶ã‡¶£)</span>
                <span class="card-value" id="report-total-mortgage">‡ß≥ 0.00</span>
            </div>
        </div>

        <!-- Cash Flow Analysis -->
        <h3 class="text-lg font-semibold mb-3 mt-5 text-light-gold border-b border-gray-700 pb-1">‡ß®. ‡¶®‡¶ó‡¶¶ ‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶π (Cash Flow) ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="report-card" style="border-color: #3182ce; background-color: rgba(49, 130, 206, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶®‡¶ó‡¶¶ ‡¶Ü‡¶ó‡¶Æ‡¶® (Cash Inflow)</span>
                <span class="card-value" id="report-inflow-total">‡ß≥ 0.00</span>
            </div>
            <div class="report-card" style="border-color: #f6ad55; background-color: rgba(246, 173, 85, 0.2);">
                <span class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶®‡¶ó‡¶¶ ‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶ó‡¶Æ‡¶® (Cash Outflow)</span>
                <span class="card-value" id="report-outflow-total">‡ß≥ 0.00</span>
            </div>
            <div class="report-card col-span-full" style="border-color: #38a169; background-color: rgba(56, 161, 105, 0.2);">
                <span class="font-medium">‡¶®‡¶ø‡¶ü ‡¶®‡¶ó‡¶¶ ‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶π (Net Cash Flow)</span>
                <span class="card-value" id="report-net-cashflow">‡ß≥ 0.00</span>
            </div>
        </div>
        
        <!-- Detailed Stock Report -->
        <h3 class="text-lg font-semibold mb-3 mt-5 text-light-gold border-b border-gray-700 pb-1">‡ß©. ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø</h3>
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‡¶®‡¶æ‡¶Æ</th>
                        <th>‡¶ì‡¶ú‡¶® (gm)</th>
                        <th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü</th>
                        <th>‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥)</th>
                    </tr>
                </thead>
                <tbody id="report-stock-list">
                    <tr><td colspan="4" class="text-center text-gray-500">‡¶∏‡ßç‡¶ü‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<!-- =================== NAVIGATION =================== -->
<div class="nav">
    <button class="active" onclick="showPage('home',this)">
        <i class="fa-solid fa-house"></i>‡¶π‡ßã‡¶Æ
    </button>
    <button onclick="showPage('sales',this)">
        <i class="fa-solid fa-money-bill-transfer"></i>‡¶®‡¶ó‡¶¶
    </button>
    <button onclick="showPage('stock',this)">
        <i class="fa-solid fa-boxes-stacked"></i>‡¶∏‡ßç‡¶ü‡¶ï
    </button>
    <button onclick="showPage('mortgage',this)">
        <i class="fa-solid fa-handshake"></i>‡¶¨‡¶®‡ßç‡¶ß‡¶ï
    </button>
    <button onclick="showPage('orders',this)">
        <i class="fa-solid fa-receipt"></i>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞
    </button>
    <button onclick="showPage('customers',this)">
        <i class="fa-solid fa-users"></i>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï
    </button>
    <button onclick="showPage('reports',this)">
        <i class="fa-solid fa-chart-line"></i>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
    </button>
</div>

<!-- =================== SCRIPT =================== -->
<script type="module">
// Firebase Imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, serverTimestamp, setLogLevel, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Global Variables
let app, db, auth;
let userId = 'anonymous'; // Default user ID
let isAdmin = false; // NEW: Role variable
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

// Mandatory Firebase Initialization
if (Object.keys(firebaseConfig).length > 0) {
    try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        setLogLevel('Debug'); // Enable debug logging for Firestore

        // Step 1: Authentication and User ID Setup
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('user-id-display').textContent = userId;
                document.getElementById('auth-status').textContent = '‚úÖ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ (‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤)';
                console.log("Authentication successful. User ID:", userId);
                
                // Start listening to roles first, then other data
                startRoleListener();
            } else {
                // Sign in anonymously or with custom token
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                document.getElementById('auth-status').textContent = '‚ö†Ô∏è ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...';
            }
        });

    } catch (error) {
        console.error("Firebase Initialization Error:", error);
        document.getElementById('auth-status').textContent = '‚ùå ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + error.message;
    }
} else {
    console.error("Firebase Config Missing: Cannot initialize Firebase.");
    document.getElementById('auth-status').textContent = '‚ùå Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§';
}

// Helper for formatting currency
const formatCurrency = (amount) => {
    return '‡ß≥ ' + (amount || 0).toLocaleString('bn-BD', { maximumFractionDigits: 0 });
};

// --- FIREBASE COLLECTION REFERENCES ---
const getStockCollectionRef = () => {
    return collection(db, `artifacts/${appId}/users/${userId}/jewelry_stock`);
};

const getCashLedgerCollectionRef = () => {
    return collection(db, `artifacts/${appId}/users/${userId}/cash_ledger`);
};

const getMortgageCollectionRef = () => {
    return collection(db, `artifacts/${appId}/users/${userId}/jewelry_mortgages`);
};

const getCustomerCollectionRef = () => {
    return collection(db, `artifacts/${appId}/users/${userId}/jewelry_customers`);
};

const getOrderCollectionRef = () => {
    return collection(db, `artifacts/${appId}/users/${userId}/jewelry_orders`);
};

// NEW: PUBLIC Collection for Roles (Accessible to all users under this app)
const getRolesCollectionRef = () => {
    // We use a specific, known ID 'user_roles' for the document containing the list
    return doc(db, `artifacts/${appId}/public/data/roles/user_roles`);
};


// --- ADMIN/ROLE LOGIC (NEW) ---

let managerIds = []; // Stores the array of manager/admin User IDs

function startRoleListener() {
    // Listen to the single document holding all manager IDs
    onSnapshot(getRolesCollectionRef(), (docSnapshot) => {
        const rolesData = docSnapshot.data();
        managerIds = rolesData?.managers || [];
        
        // Check if the current user is an admin
        isAdmin = managerIds.includes(userId);
        
        // Update UI based on role
        updateRoleUI();

        // After roles are loaded, start listening to user-specific data
        startFirestoreListeners();

    }, (error) => {
        console.error("Error fetching role data:", error);
        // Still start other listeners even if role fetching failed
        startFirestoreListeners();
    });
}


function updateRoleUI() {
    const roleDisplay = document.getElementById('user-role-display');
    const adminPanel = document.getElementById('admin-panel');
    const managerIdsList = document.getElementById('manager-ids-list');

    if (isAdmin) {
        roleDisplay.textContent = '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®';
        roleDisplay.className = 'font-bold px-2 py-1 rounded-full text-xs bg-red-800 text-red-300';
        adminPanel.classList.remove('hidden');
        managerIdsList.textContent = managerIds.join(', ');
        
        // Ensure the current Admin ID is in the list display if not already added
        if (!managerIds.includes(userId)) {
             managerIdsList.textContent = `${userId} (‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®) | ${managerIds.join(', ')}`;
        }

    } else {
        roleDisplay.textContent = '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á'; // Assuming all users are 'manager' or 'admin' in this context
        roleDisplay.className = 'font-bold px-2 py-1 rounded-full text-xs bg-gray-700 text-gray-400';
        adminPanel.classList.add('hidden');
    }
}

// Function to add a new manager ID
const addManagerId = async () => {
    const newManagerId = document.getElementById('new-manager-id').value.trim();
    if (!newManagerId) return;

    if (!isAdmin) {
        console.error("Only an Admin can add new managers.");
        return;
    }

    if (managerIds.includes(newManagerId)) {
        console.log("This User ID is already a manager.");
        document.getElementById('new-manager-id').value = '';
        return;
    }

    try {
        const newManagerList = [...managerIds, newManagerId];
        await setDoc(getRolesCollectionRef(), { managers: newManagerList }, { merge: true });
        console.log(`User ID ${newManagerId} added as a manager.`);
        document.getElementById('new-manager-id').value = '';

    } catch (error) {
        console.error("Error adding manager ID:", error);
    }
}
window.addManagerId = addManagerId; // Make it globally accessible for the onclick event


// --- ORDER LOGIC (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞) ---

// Function to handle new order submission (Access: All users can create)
document.getElementById('order-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const customerName = document.getElementById('order-customer-name').value.trim();
    const itemDescription = document.getElementById('order-item-description').value.trim();
    const requiredGold = parseFloat(document.getElementById('order-required-gold').value);
    const purity = document.getElementById('order-purity').value;
    const makingCharge = parseFloat(document.getElementById('order-making-charge').value);
    const advancePayment = parseFloat(document.getElementById('order-advance-payment').value) || 0;
    const deliveryDate = document.getElementById('order-delivery-date').value;
    
    if (!customerName || !itemDescription || isNaN(requiredGold) || !purity || isNaN(makingCharge) || makingCharge < 0 || requiredGold <= 0) {
        console.error('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        return;
    }

    const totalDue = makingCharge - advancePayment;

    const newOrder = {
        customer: customerName,
        itemDescription: itemDescription,
        requiredGold: requiredGold, 
        purity: purity,
        makingCharge: makingCharge,
        advancePayment: advancePayment,
        totalDue: totalDue,
        deliveryDate: deliveryDate,
        orderDate: serverTimestamp(),
        status: 'Pending',
        createdBy: userId, // New field for accountability
    };

    try {
        const orderDocRef = await addDoc(getOrderCollectionRef(), newOrder);
        
        if (advancePayment > 0) {
            const cashInTransaction = {
                amount: advancePayment,
                type: 'inflow',
                description: `‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ${customerName} - ${itemDescription}`,
                party: customerName,
                relatedOrderId: orderDocRef.id,
                timestamp: serverTimestamp(),
            };
            await addDoc(getCashLedgerCollectionRef(), cashInTransaction);
        }
        
        e.target.reset();
        console.log(`‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡ß≥${advancePayment} ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

    } catch (error) {
        console.error("Error adding order:", error);
    }
});

// Function to mark an order as Delivered (Access: All users can finalize)
const finalizeOrder = async (orderId, customerName, totalDue) => {
    if (totalDue > 0) {
        // Use custom message box instead of confirm()
        if (!window.confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡ß≥${totalDue.toLocaleString('bn-BD')} ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`)) return;

        const cashInTransaction = {
            amount: totalDue,
            type: 'inflow',
            description: `‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ${customerName} ‡¶è‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ`,
            party: customerName,
            relatedOrderId: orderId,
            timestamp: serverTimestamp(),
            collectedBy: userId, // New field
        };
        await addDoc(getCashLedgerCollectionRef(), cashInTransaction);
    } else {
        if (!window.confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ${formatCurrency(totalDue)}`)) return;
    }
    
    try {
        await setDoc(doc(db, getOrderCollectionRef().path, orderId), {
            status: 'Delivered',
            deliveryDateFinal: serverTimestamp(),
            finalDueCollected: totalDue,
            finalizedBy: userId, // New field
        }, { merge: true }); 
        console.log("Order successfully finalized and delivered:", orderId);
        
    } catch (error) {
        console.error("Error finalizing order:", error);
    }
}
window.finalizeOrder = finalizeOrder;


// --- CUSTOMER LOGIC (‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï) ---
// (No change in access control needed here)

document.getElementById('customer-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('customer-name-input').value.trim();
    const phone = document.getElementById('customer-phone-input').value.trim();
    const address = document.getElementById('customer-address-input').value.trim();
    
    if (!name || !phone) {
        console.error('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        return;
    }

    const newCustomer = {
        name: name,
        phone: phone,
        address: address,
        createdDate: serverTimestamp(),
    };

    try {
        await addDoc(getCustomerCollectionRef(), newCustomer);
        e.target.reset();
        console.log(`‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ${name} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

    } catch (error) {
        console.error("Error adding customer:", error);
    }
});

// Function to delete a customer (Access: Restricted to Admin)
const deleteCustomer = async (docId, name) => {
    if (!isAdmin) {
        // Use custom message box instead of confirm()
        console.error("‚ö†Ô∏è ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§");
        return;
    }

    if (!window.confirm(`[‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®] ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ${name} ‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) return; 

    try {
        await deleteDoc(doc(db, getCustomerCollectionRef().path, docId));
        console.log("Customer successfully deleted:", docId);
    } catch (error) {
        console.error("Error deleting customer:", error);
    }
}
window.deleteCustomer = deleteCustomer; 


// --- MORTGAGE LOGIC (‡¶¨‡¶®‡ßç‡¶ß‡¶ï) ---
// (No change in access control needed here)

document.getElementById('mortgage-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const customerName = document.getElementById('mortgage-customer-name').value;
    const itemDescription = document.getElementById('mortgage-item-description').value;
    const goldWeight = parseFloat(document.getElementById('mortgage-gold-weight').value);
    const purity = document.getElementById('mortgage-purity').value;
    const principalAmount = parseFloat(document.getElementById('mortgage-principal-amount').value);
    const interestRate = parseFloat(document.getElementById('mortgage-interest-rate').value);
    const termMonths = parseInt(document.getElementById('mortgage-term-months').value, 10);
    
    if (!customerName || !itemDescription || isNaN(goldWeight) || !purity || isNaN(principalAmount) || isNaN(interestRate) || isNaN(termMonths) || principalAmount <= 0) {
        console.error('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        return;
    }

    const newMortgage = {
        customer: customerName,
        itemDescription: itemDescription,
        weight: goldWeight,
        purity: purity,
        principalAmount: principalAmount,
        interestRate: interestRate,
        termMonths: termMonths,
        startDate: serverTimestamp(),
        status: 'Active',
        createdBy: userId, // New field
        repaymentHistory: [], 
    };

    try {
        const mortgageDocRef = await addDoc(getMortgageCollectionRef(), newMortgage);
        
        const cashOutTransaction = {
            amount: -principalAmount,
            type: 'outflow',
            description: `‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® - ${customerName} ‡¶ï‡ßá ‡¶ã‡¶£`,
            party: customerName,
            relatedMortgageId: mortgageDocRef.id,
            timestamp: serverTimestamp(),
        };
        await addDoc(getCashLedgerCollectionRef(), cashOutTransaction);
        
        e.target.reset();
        console.log(`‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡ß≥${principalAmount} ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶ó‡¶Æ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

    } catch (error) {
        console.error("Error adding mortgage:", error);
    }
});


// Function to simulate repayment (Access: All users can redeem)
const redeemMortgage = async (mortgageId, principal, rate, description) => {
    
    if (!window.confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶¨‡¶®‡ßç‡¶ß‡¶ï‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá? (${description})`)) return;

    // Simplified calculation for demonstration.
    const monthsPassed = 1; 
    const interestDue = (principal * rate / 100) * monthsPassed;
    const totalRepayment = principal + interestDue;

    try {
        // 1. Update the Mortgage Status
        await setDoc(doc(db, getMortgageCollectionRef().path, mortgageId), {
            status: 'Redeemed',
            redemptionDate: serverTimestamp(),
            totalRepaymentReceived: totalRepayment,
            finalInterest: interestDue,
            redeemedBy: userId, // New field
        }, { merge: true }); 
        
        // 2. Record the Cash Inflow (Repayment)
        const cashInTransaction = {
            amount: totalRepayment,
            type: 'inflow',
            description: `‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß (‡¶Æ‡ßÇ‡¶≤: ${principal.toLocaleString('bn-BD')}, ‡¶∏‡ßÅ‡¶¶: ${interestDue.toLocaleString('bn-BD')}) - ${description}`,
            party: 'Mortgage Redemption',
            relatedMortgageId: mortgageId,
            timestamp: serverTimestamp(),
        };
        await addDoc(getCashLedgerCollectionRef(), cashInTransaction);

    } catch (error) {
        console.error("Error redeeming mortgage:", error);
    }
}
window.redeemMortgage = redeemMortgage;

// --- CASH TRANSACTION LOGIC (‡¶®‡¶ó‡¶¶ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®) ---
// (No change in access control needed here)

document.getElementById('cash-transaction-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const type = document.getElementById('transaction-type').value;
    const amount = parseFloat(document.getElementById('transaction-amount').value);
    const description = document.getElementById('transaction-description').value;
    const customer = document.getElementById('customer-name').value || 'N/A';
    
    if (isNaN(amount) || amount <= 0 || !description) {
        console.error('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ì ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®‡•§');
        return;
    }
    
    const signedAmount = type === 'inflow' ? amount : -amount;

    const newTransaction = {
        amount: signedAmount,
        type: type,
        description: description,
        party: customer,
        timestamp: serverTimestamp(),
        recordedBy: userId, // New field
    };

    try {
        await addDoc(getCashLedgerCollectionRef(), newTransaction);
        console.log("New Cash Transaction added:", newTransaction);
        e.target.reset();
    } catch (error) {
        console.error("Error adding cash transaction:", error);
    }
});


// --- CORE STOCK LOGIC (‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü/‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü) ---

// Function to add a new stock item (Investment) (Access: All users can add)
document.getElementById('stock-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const itemName = document.getElementById('item-name').value;
    const goldWeight = parseFloat(document.getElementById('gold-weight').value);
    const purity = document.getElementById('purity').value;
    const purchasePrice = parseFloat(document.getElementById('purchase-price').value);

    if (!itemName || isNaN(goldWeight) || !purity || isNaN(purchasePrice)) {
        console.error('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); 
        return;
    }

    const newItem = {
        name: itemName,
        weight: goldWeight,
        purity: purity,
        purchasePrice: purchasePrice,
        timestamp: serverTimestamp(),
        status: 'In Stock',
        recordedBy: userId, // New field
    };

    try {
        const docRef = await addDoc(getStockCollectionRef(), newItem);
        
        const investmentTransaction = {
            amount: -purchasePrice,
            type: 'outflow',
            description: `‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º: ${itemName} (${goldWeight}gm)`,
            party: 'Supplier/Self-Investment',
            relatedStockId: docRef.id, 
            timestamp: serverTimestamp(),
        };
        await addDoc(getCashLedgerCollectionRef(), investmentTransaction);

        e.target.reset();
        
    } catch (error) {
        console.error("Error adding stock item:", error);
    }
});

// Function to delete a stock item (Access: Restricted to Admin)
const deleteStockItem = async (docId) => {
    if (!isAdmin) {
        console.error("‚ö†Ô∏è ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§");
        return;
    }
    
    if (!window.confirm("[‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®] ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return; 

    try {
        await deleteDoc(doc(db, getStockCollectionRef().path, docId));
        console.log("Stock Item successfully deleted:", docId);
    } catch (error) {
        console.error("Error deleting stock item:", error);
    }
}
window.deleteStockItem = deleteStockItem; 


// --- REAL-TIME LISTENERS & DASHBOARD/REPORT UPDATES ---

function startFirestoreListeners() {
    if (!db || userId === 'anonymous') {
        console.error("Database or User ID is not ready.");
        return;
    }

    // 1. Customer Listener
    onSnapshot(query(getCustomerCollectionRef()), (snapshot) => {
        const customerListBody = document.getElementById('customer-list-body');
        const customerList = [];

        snapshot.forEach((doc) => {
            customerList.push({ id: doc.id, ...doc.data() });
        });
        
        customerList.sort((a, b) => b.createdDate?.toMillis() - a.createdDate?.toMillis());

        customerListBody.innerHTML = customerList.map(customer => `
            <tr class="text-sm">
                <td class="font-semibold">${customer.name}</td>
                <td>${customer.phone}</td>
                <td class="text-xs text-gray-400">${customer.address || 'N/A'}</td>
                <td>
                    <button onclick="deleteCustomer('${customer.id}', '${customer.name}')" 
                            class="font-bold p-1 rounded transition ${isAdmin ? 'text-red-500 hover:text-red-300' : 'text-gray-600 cursor-not-allowed'}"
                            ${isAdmin ? '' : 'disabled'} title="${isAdmin ? '‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®'}">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
        
        if (customerList.length === 0) {
            customerListBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 py-4">‡¶ï‡ßã‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶®‡ßá‡¶á‡•§</td></tr>';
        }

    }, (error) => {
        console.error("Error fetching customer data:", error);
    });

    // 2. Order Listener
    onSnapshot(query(getOrderCollectionRef()), (snapshot) => {
        const orderListBody = document.getElementById('order-list-body');
        const orders = [];
        let totalDue = 0;

        snapshot.forEach((doc) => {
            const data = doc.data();
            orders.push({ id: doc.id, ...data });
            if (data.status === 'Pending' || data.status === 'Completed') {
                totalDue += data.totalDue || 0; 
            }
        });
        
        document.getElementById('total-order-due').textContent = formatCurrency(totalDue);
        document.getElementById('report-total-order-due').textContent = formatCurrency(totalDue);
        
        orders.sort((a, b) => b.orderDate?.toMillis() - a.orderDate?.toMillis());

        orderListBody.innerHTML = orders.map(order => {
            const statusColor = order.status === 'Delivered' ? 'text-green-400' : (order.status === 'Pending' ? 'text-yellow-400' : 'text-blue-400');
            
            const actionButton = order.status !== 'Delivered' ? 
                `<button onclick="finalizeOrder('${order.id}', '${order.customer}', ${order.totalDue})" 
                        class="bg-green-700 text-white text-xs p-1 rounded hover:bg-green-600">
                    ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¶‡¶ø‡¶®
                </button>` : 
                `<span class="text-xs text-gray-500">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£</span>`;

            return `
                <tr class="text-sm">
                    <td>${order.customer}</td>
                    <td>${order.itemDescription}</td>
                    <td>${order.requiredGold ? order.requiredGold.toFixed(2) : 'N/A'}</td>
                    <td>${formatCurrency(order.makingCharge)}</td>
                    <td>${formatCurrency(order.advancePayment)}</td>
                    <td class="${statusColor} font-semibold">${order.status}</td>
                    <td>${actionButton}</td>
                </tr>
            `;
        }).join('');

        if (orders.length === 0) {
            orderListBody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500 py-4">‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶®‡ßá‡¶á‡•§</td></tr>';
        }

    }, (error) => {
        console.error("Error fetching order data:", error);
    });


    // 3. Stock Listener
    onSnapshot(getStockCollectionRef(), (snapshot) => {
        const stockListBody = document.getElementById('stock-list-body');
        const reportStockList = document.getElementById('report-stock-list');
        const stockList = [];
        let totalInvestmentValue = 0;

        snapshot.forEach((doc) => {
            const data = doc.data();
            stockList.push({ id: doc.id, ...data });
            totalInvestmentValue += data.purchasePrice || 0;
        });

        stockList.sort((a, b) => b.timestamp?.toMillis() - a.timestamp?.toMillis());

        // Update Stock List UI (STOCK page) - Deletion restricted to Admin
        stockListBody.innerHTML = stockList.map(item => `
            <tr class="text-sm">
                <td>${item.name}</td>
                <td>${item.weight ? item.weight.toFixed(2) : 'N/A'}</td>
                <td>${item.purity}K</td>
                <td>${formatCurrency(item.purchasePrice)}</td>
                <td>
                    <button onclick="deleteStockItem('${item.id}')" 
                            class="font-bold p-1 rounded transition ${isAdmin ? 'text-red-500 hover:text-red-300' : 'text-gray-600 cursor-not-allowed'}"
                            ${isAdmin ? '' : 'disabled'} title="${isAdmin ? '‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®'}">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
        
        // Update Stock Report UI (REPORTS page)
        reportStockList.innerHTML = stockList.map(item => `
            <tr class="text-sm">
                <td>${item.name}</td>
                <td>${item.weight ? item.weight.toFixed(2) : 'N/A'}</td>
                <td>${item.purity}K</td>
                <td>${formatCurrency(item.purchasePrice)}</td>
            </tr>
        `).join('');

        // Update Dashboard & Report Stock Value
        document.getElementById('total-stock-value').textContent = formatCurrency(totalInvestmentValue);
        document.getElementById('report-total-stock').textContent = formatCurrency(totalInvestmentValue);


    }, (error) => {
        console.error("Error fetching stock data:", error);
    });
    
    // 4. Cash Ledger Listener
    onSnapshot(getCashLedgerCollectionRef(), (snapshot) => {
        const ledgerBody = document.getElementById('cash-ledger-body');
        const transactions = [];
        let totalCash = 0;
        let totalInflow = 0;
        let totalOutflow = 0;

        snapshot.forEach((doc) => {
            const data = doc.data();
            const amount = data.amount || 0;
            transactions.push({ id: doc.id, ...data });
            totalCash += amount;
            
            if (amount > 0) {
                totalInflow += amount;
            } else {
                totalOutflow += Math.abs(amount);
            }
        });

        transactions.sort((a, b) => b.timestamp?.toMillis() - a.timestamp?.toMillis());
        
        // --- Dashboard Updates ---
        document.getElementById('total-cash-display').textContent = formatCurrency(totalCash);
        document.getElementById('total-cash-display').classList.toggle('text-red-500', totalCash < 0);
        document.getElementById('total-cash-display').classList.toggle('text-green-500', totalCash >= 0);

        // --- Report Updates (Cash Flow Analysis) ---
        document.getElementById('report-total-cash').textContent = formatCurrency(totalCash);
        document.getElementById('report-inflow-total').textContent = formatCurrency(totalInflow);
        document.getElementById('report-outflow-total').textContent = formatCurrency(totalOutflow);
        document.getElementById('report-net-cashflow').textContent = formatCurrency(totalInflow - totalOutflow);
        document.getElementById('report-net-cashflow').style.borderColor = (totalInflow - totalOutflow) >= 0 ? '#38a169' : '#e53e3e';


        // Update Cash Ledger UI (Displaying only the last 10 for brevity)
        ledgerBody.innerHTML = transactions.slice(0, 10).map(tx => {
            const date = tx.timestamp ? new Date(tx.timestamp.toDate()).toLocaleDateString('bn-BD') : 'N/A';
            const signClass = tx.amount > 0 ? 'text-green-400' : 'text-red-400';
            const amountDisplay = Math.abs(tx.amount).toLocaleString('bn-BD', { maximumFractionDigits: 0 });
            
            return `
                <tr class="text-xs">
                    <td>${date}</td>
                    <td>${tx.description}</td>
                    <td class="${signClass}">${tx.type === 'inflow' ? '‡¶Ü‡¶ó‡¶Æ‡¶®' : '‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶ó‡¶Æ‡¶®'}</td>
                    <td class="font-bold ${signClass}">‡ß≥ ${amountDisplay}</td>
                </tr>
            `;
        }).join('');

    }, (error) => {
        console.error("Error fetching cash ledger data:", error);
    });
    
    // 5. Mortgage Listener
    onSnapshot(query(getMortgageCollectionRef()), (snapshot) => {
        const mortgageListBody = document.getElementById('mortgage-list-body');
        const activeMortgages = [];
        let totalOutstandingMortgage = 0;

        snapshot.forEach((doc) => {
            const data = doc.data();
            if (data.status === 'Active') {
                activeMortgages.push({ id: doc.id, ...data });
                totalOutstandingMortgage += data.principalAmount || 0; 
            }
        });
        
        document.getElementById('total-mortgage-value').textContent = formatCurrency(totalOutstandingMortgage);
        document.getElementById('report-total-mortgage').textContent = formatCurrency(totalOutstandingMortgage);
        
        // Update Mortgage List UI
        mortgageListBody.innerHTML = activeMortgages.map(m => `
            <tr class="text-sm">
                <td>${m.customer}</td>
                <td>${m.weight ? m.weight.toFixed(2) : 'N/A'} gm</td>
                <td>${formatCurrency(m.principalAmount)}</td>
                <td>${m.interestRate}%</td>
                <td class="text-red-400 font-semibold">${m.status}</td>
                <td>
                    <button onclick="redeemMortgage('${m.id}', ${m.principalAmount}, ${m.interestRate}, '${m.customer} ‡¶è‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡¶ï')" 
                            class="bg-green-700 text-white text-xs p-1 rounded hover:bg-green-600">
                        ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß
                    </button>
                </td>
            </tr>
        `).join('');

    }, (error) => {
        console.error("Error fetching mortgage data:", error);
    });
}

// --- UI Navigation Logic ---
function showPage(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    document.getElementById(id).style.display = 'block';

    document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}
window.showPage = showPage;
</script>

