<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ú‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤‡¶æ‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶ü‡¶ì‡¶Ø‡¶º‡ßç‡¶Ø‡¶æ‡¶∞</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FFD700; /* Gold */
            --secondary: #0a0a0a; /* Dark background */
        }
        body {
            font-family: 'Noto Sans Bengali', 'Inter', sans-serif;
            background-color: #f4f4f9;
        }
        .sidebar {
            background-color: var(--secondary);
            transition: all 0.3s ease;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            color: #ccc;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-item:hover, .nav-item.active {
            background-color: #2c2c2c;
            color: var(--primary);
        }
        .nav-item.active {
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        .dashboard-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.3s;
        }
        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 10px rgba(0, 0, 0, 0.15);
        }
        .primary-btn {
            background-color: var(--primary);
            color: var(--secondary);
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.6rem 1.25rem;
            transition: background-color 0.2s;
        }
        .primary-btn:hover {
            background-color: #e6c500;
        }
        /* Custom scrollbar for content area */
        .content-area::-webkit-scrollbar {
            width: 8px;
        }
        .content-area::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-white/70 backdrop-blur-sm z-50 flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-yellow-500"></div>
        <p class="mt-4 text-gray-700 font-semibold">‡¶∏‡¶´‡¶ü‡¶ì‡¶Ø‡¶º‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <!-- Sidebar (Hidden on Mobile, shown via button) -->
    <div id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 p-4 z-40 transform -translate-x-full md:relative md:translate-x-0 md:flex-shrink-0">
        <h1 class="text-2xl font-bold text-white mb-8 border-b border-gray-700 pb-3">üíé ‡¶ú‡ßÅ‡¶Ø‡¶º‡ßá‡¶≤‡¶æ‡¶∞‡¶ø POS</h1>

        <!-- User Role Display -->
        <div class="mb-6 p-3 bg-gray-800 rounded-lg text-sm">
            <p class="text-gray-400">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ:</p>
            <p id="current-user-id" class="text-xs text-yellow-500 truncate mb-1">ID: Loading...</p>
            <p id="current-role" class="font-semibold text-white">‡¶∞‡ßã‡¶≤: ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>

        <nav id="module-nav">
            <!-- Navigation items will be inserted here based on role -->
        </nav>
        
        <div class="absolute bottom-4 w-full pr-8">
            <button onclick="changeRolePrompt()" class="w-full primary-btn bg-gray-700 text-white hover:bg-gray-600">
                <i data-lucide="users" class="inline-block w-4 h-4 mr-2"></i> ‡¶∞‡ßã‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 overflow-auto content-area p-4 md:p-8">
        <!-- Mobile Menu Toggle -->
        <button id="menu-toggle" class="md:hidden p-2 text-gray-700 rounded-lg hover:bg-gray-200 focus:outline-none mb-4">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
        
        <header class="mb-8 flex justify-between items-center">
            <h2 id="page-title" class="text-3xl font-bold text-gray-800">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
        </header>

        <!-- Main Content View -->
        <main id="main-content-view">
            <!-- Content of the active module will be loaded here -->
        </main>
        
        <!-- Custom Modal for Role Change -->
        <div id="role-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded-xl w-full max-w-sm">
                <h3 class="text-xl font-bold mb-4 text-gray-800">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶∞‡ßã‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</h3>
                <p class="mb-4 text-sm text-gray-600">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡ßã‡¶≤ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®‡•§</p>
                <select id="role-selector" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-yellow-500 focus:border-yellow-500">
                    <option value="admin">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®/‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï</option>
                    <option value="manager">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</option>
                    <option value="sales">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ</option>
                    <option value="accountant">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡¶∞‡¶ï‡ßç‡¶∑‡¶ï</option>
                </select>
                <div class="flex justify-end space-x-3">
                    <button onclick="document.getElementById('role-modal').classList.add('hidden')" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    <button onclick="setAndSaveRole()" class="primary-btn">‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <!-- Custom Notification Message Box -->
        <div id="message-box" class="fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white hidden transition-opacity duration-300"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase Instances
        let app, db, auth;
        let userId = 'default-user';
        let currentUserRole = 'admin'; // Default role
        let isAuthReady = false;

        // MANDATORY: Global variables provided by Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- Utility Functions ---

        /**
         * Shows a custom notification message instead of alert().
         * @param {string} message - The message to display.
         * @param {string} type - 'success' or 'error'.
         */
        function showMessage(message, type = 'success') {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.className = 'fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white transition-opacity duration-300';
            
            if (type === 'success') {
                box.classList.add('bg-green-600');
            } else if (type === 'error') {
                box.classList.add('bg-red-600');
            } else {
                 box.classList.add('bg-blue-600');
            }

            box.classList.remove('hidden');
            box.style.opacity = '1';

            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 3000);
        }

        /**
         * Converts Gold weight from Bhari/Ana/Roti/Point to Grams.
         * 1 Bhari = 16 Ana, 1 Ana = 4 Roti, 1 Roti = 4 Point.
         * 1 Bhari ‚âà 11.664 grams (Bangladesh Standard)
         * @param {number} bhari
         * @param {number} ana
         * @param {number} roti
         * @param {number} point
         * @returns {string} Weight in grams (3 decimal places).
         */
        function voriToGram(bhari, ana, roti, point) {
            const VORI_TO_GRAM = 11.664;
            const POINTS_PER_VORI = 16 * 4 * 4; // 256
            
            const totalPoints = (bhari * POINTS_PER_VORI) + (ana * 4 * 4) + (roti * 4) + point;
            
            if (totalPoints === 0) return '0.000';

            const grams = (totalPoints * VORI_TO_GRAM) / POINTS_PER_VORI;
            return grams.toFixed(3);
        }

        // --- Firebase Initialization and Authentication ---

        async function initializeFirebase() {
            setLogLevel('debug'); // For debugging any potential issues

            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                document.getElementById('loading-overlay').classList.add('hidden');
                showMessage("Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶Ö‡¶®‡ßÅ‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá‡•§", 'error');
                isAuthReady = true;
                renderNavigation(currentUserRole);
                loadView('dashboard');
                return;
            }
            
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // 1. Setup Auth State Listener (Critical: This will fire once auth status is known)
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('current-user-id').textContent = `ID: ${userId}`;
                        await loadUserRole(userId);
                        
                        // Start listeners and load initial view
                        startModuleListeners(); 
                        renderNavigation(currentUserRole);
                        loadView(currentUserRole === 'admin' ? 'dashboard' : 'dashboard');

                    } else {
                        // If authentication fails or user signs out
                        userId = crypto.randomUUID();
                        document.getElementById('current-user-id').textContent = `ID: (Anonymous) ${userId.substring(0, 8)}...`;
                        renderNavigation(currentUserRole);
                        loadView('dashboard');
                    }
                    
                    // Mark auth ready and hide loading screen
                    isAuthReady = true;
                    document.getElementById('loading-overlay').classList.add('hidden');
                });

                // 2. Initial Authentication Attempt
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Fallback to anonymous sign-in if no custom token is available
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Error during Firebase initialization or sign-in:", error);
                
                // CRITICAL FIX: Ensure loading overlay is hidden upon error
                document.getElementById('loading-overlay').classList.add('hidden');
                showMessage(`Firebase ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}. ‡¶∏‡¶æ‡¶á‡¶®-‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'error');

                // Load the view anyway, but with limited functionality
                isAuthReady = false; 
                renderNavigation(currentUserRole);
                loadView('dashboard');
            }
        }

        // --- Role Management and Access Control ---

        const userRoles = {
            admin: { name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®/‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï', modules: ['dashboard', 'inventory', 'finance', 'mortgage', 'karigor', 'reports', 'settings'] },
            manager: { name: '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞', modules: ['dashboard', 'inventory', 'finance', 'mortgage', 'reports'] },
            sales: { name: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ', modules: ['sales', 'inventory', 'dashboard'] },
            accountant: { name: '‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡¶∞‡¶ï‡ßç‡¶∑‡¶ï', modules: ['dashboard', 'finance', 'mortgage', 'reports'] },
        };

        const moduleIcons = {
            dashboard: 'layout-dashboard',
            inventory: 'warehouse',
            sales: 'shopping-cart',
            finance: 'dollar-sign',
            mortgage: 'banknote',
            karigor: 'hammer',
            reports: 'bar-chart-2',
            settings: 'settings',
        };

        const moduleNames = {
            dashboard: '‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°',
            inventory: '‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø/‡¶∏‡ßç‡¶ü‡¶ï',
            sales: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ì ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®',
            finance: '‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ì ‡¶´‡¶ø‡¶®‡¶æ‡¶®‡ßç‡¶∏',
            mortgage: '‡¶Æ‡¶∞‡ßç‡¶ó‡ßá‡¶ú (‡¶¨‡¶®‡ßç‡¶ß‡¶ï)',
            karigor: '‡¶ï‡¶æ‡¶∞‡¶ø‡¶ó‡¶∞ ‡¶ì ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞',
            reports: '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ø‡¶Ç',
            settings: '‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏',
        };

        async function loadUserRole(uid) {
            if (!db) return;
            const userDocRef = doc(db, `artifacts/${appId}/users/${uid}`, 'profile');
            try {
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists()) {
                    currentUserRole = userDoc.data().role || 'admin';
                }
            } catch (error) {
                console.warn("Could not load user role, defaulting to admin:", error);
                currentUserRole = 'admin';
            }
            document.getElementById('current-role').textContent = `‡¶∞‡ßã‡¶≤: ${userRoles[currentUserRole].name}`;
        }

        function changeRolePrompt() {
            const selector = document.getElementById('role-selector');
            selector.value = currentUserRole;
            document.getElementById('role-modal').classList.remove('hidden');
        }

        async function setAndSaveRole() {
            const newRole = document.getElementById('role-selector').value;
            if (!userRoles[newRole]) return;

            document.getElementById('role-modal').classList.add('hidden');
            
            // Save the new role to Firestore
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}`, 'profile');
            try {
                if(db && userId) { // Check if Firestore and userId are ready
                    await setDoc(userDocRef, { role: newRole }, { merge: true });
                }
                
                currentUserRole = newRole;
                document.getElementById('current-role').textContent = `‡¶∞‡ßã‡¶≤: ${userRoles[currentUserRole].name}`;
                showMessage(`‡¶∞‡ßã‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userRoles[currentUserRole].name}`, 'success');
                
                renderNavigation(currentUserRole);
                loadView('dashboard'); // Always go to dashboard after role change
            } catch (error) {
                console.error("Error saving new role:", error);
                showMessage("‡¶∞‡ßã‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ (‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®)", 'error');
            }
        }
        
        function renderNavigation(role) {
            const nav = document.getElementById('module-nav');
            nav.innerHTML = '';
            const modules = userRoles[role].modules;

            modules.forEach(moduleId => {
                const name = moduleNames[moduleId];
                const icon = moduleIcons[moduleId];
                const item = document.createElement('div');
                item.className = 'nav-item';
                item.id = `nav-${moduleId}`;
                item.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5 mr-3"></i> ${name}`;
                item.onclick = () => loadView(moduleId);
                nav.appendChild(item);
            });
            // Re-render lucide icons after injecting HTML
            lucide.createIcons();
        }

        // --- View Rendering Logic ---

        function setActiveNav(moduleId) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.getElementById(`nav-${moduleId}`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function loadView(moduleId) {
            setActiveNav(moduleId);
            document.getElementById('page-title').textContent = moduleNames[moduleId];
            const content = document.getElementById('main-content-view');
            content.innerHTML = ''; // Clear existing content

            let html = '';

            switch (moduleId) {
                case 'dashboard':
                    html = renderDashboardView();
                    break;
                case 'inventory':
                    html = renderInventoryView();
                    break;
                case 'sales':
                    html = renderSalesView();
                    break;
                case 'finance':
                    html = renderFinanceView();
                    break;
                case 'mortgage':
                    html = renderMortgageView();
                    break;
                case 'karigor':
                    html = renderKarigorView();
                    break;
                case 'reports':
                    html = renderReportsView();
                    break;
                case 'settings':
                    html = renderSettingsView();
                    break;
                default:
                    html = `<p class="text-gray-500">‡¶è‡¶á ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>`;
            }

            content.innerHTML = html;
            // Re-render lucide icons for the new content
            lucide.createIcons();
            
            // Specific initialisation for views
            if (moduleId === 'inventory') {
                document.getElementById('convert-btn').onclick = convertWeight;
            } else if (moduleId === 'mortgage') {
                document.getElementById('calculate-interest-btn').onclick = calculateSimpleInterest;
            }
        }

        function renderDashboardView() {
            return `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Card 1: Total Sales -->
                    <div class="dashboard-card border-l-4 border-yellow-500">
                        <p class="text-sm font-medium text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º (‡¶Ü‡¶ú)</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">‡ß≥ 2,50,000</p>
                        <div class="flex items-center text-sm mt-2">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-500 mr-1"></i>
                            <span class="text-green-500">‡ß®.‡ß´%</span> 
                            <span class="text-gray-500 ml-1">‡¶ó‡¶§‡¶ï‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá</span>
                        </div>
                    </div>
                    <!-- Card 2: Current Gold Stock -->
                    <div class="dashboard-card border-l-4 border-gray-700">
                        <p class="text-sm font-medium text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶ï</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">50.123 ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
                        <p class="text-sm text-gray-500 mt-2">‡ß™ ‡¶≠‡¶∞‡¶ø ‡ß≠ ‡¶Ü‡¶®‡¶æ ‡ß® ‡¶∞‡¶§‡¶ø</p>
                    </div>
                    <!-- Card 3: Active Mortgages -->
                    <div class="dashboard-card border-l-4 border-blue-500">
                        <p class="text-sm font-medium text-gray-500">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶¨‡¶®‡ßç‡¶ß‡¶ï</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">‡ß≥ 5,50,000</p>
                        <p class="text-sm text-gray-500 mt-2">‡¶Æ‡ßã‡¶ü ‡ßß‡ß´‡¶ü‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</p>
                    </div>
                    <!-- Card 4: Due Payments -->
                    <div class="dashboard-card border-l-4 border-red-500">
                        <p class="text-sm font-medium text-gray-500">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1">‡ß≥ 35,000</p>
                        <p class="text-sm text-red-500 mt-2">‡ß®‡¶ü‡¶ø ‡¶Æ‡¶∞‡ßç‡¶ó‡ßá‡¶ú ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶â‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£</p>
                    </div>
                </div>
                
                <h3 class="text-xl font-bold text-gray-800 mt-8 mb-4">‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</h3>
                <div class="dashboard-card h-80">
                    <p class="text-gray-500">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá‡•§</p>
                </div>
            `;
        }

        // --- Core Feature: Inventory Unit Conversion (Bhari to Gram) ---

        function convertWeight() {
            const bhari = parseFloat(document.getElementById('bhari-input').value) || 0;
            const ana = parseFloat(document.getElementById('ana-input').value) || 0;
            const roti = parseFloat(document.getElementById('roti-input').value) || 0;
            const point = parseFloat(document.getElementById('point-input').value) || 0;

            if (bhari < 0 || ana < 0 || roti < 0 || point < 0) {
                 document.getElementById('conversion-result').textContent = "‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§";
                 document.getElementById('conversion-result').classList.add('text-red-500');
                 return;
            }

            const grams = voriToGram(bhari, ana, roti, point);
            
            document.getElementById('conversion-result').textContent = `${grams} ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ`;
            document.getElementById('conversion-result').classList.remove('text-red-500');
            showMessage("‡¶ì‡¶ú‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", 'success');
        }

        function renderInventoryView() {
            return `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Panel: Unit Conversion -->
                    <div class="lg:col-span-1 dashboard-card p-6 border-l-4 border-yellow-500">
                        <h3 class="text-xl font-bold mb-4">‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶ì‡¶ú‡¶® ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ (‡¶≠‡¶∞‡¶ø ‚Üí ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="bhari-input" class="block text-sm font-medium text-gray-700">‡¶≠‡¶∞‡¶ø</label>
                                <input type="number" id="bhari-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" value="0">
                            </div>
                            <div>
                                <label for="ana-input" class="block text-sm font-medium text-gray-700">‡¶Ü‡¶®‡¶æ (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßß‡ß¨)</label>
                                <input type="number" id="ana-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" value="0">
                            </div>
                            <div>
                                <label for="roti-input" class="block text-sm font-medium text-gray-700">‡¶∞‡¶§‡¶ø (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß™)</label>
                                <input type="number" id="roti-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" value="0">
                            </div>
                            <div>
                                <label for="point-input" class="block text-sm font-medium text-gray-700">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß™)</label>
                                <input type="number" id="point-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" value="0">
                            </div>
                        </div>

                        <button id="convert-btn" class="w-full primary-btn mt-6">
                            <i data-lucide="repeat" class="inline-block w-4 h-4 mr-2"></i> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        
                        <div class="mt-6 p-4 bg-gray-100 rounded-lg">
                            <p class="text-sm text-gray-600">‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ ‡¶ì‡¶ú‡¶®:</p>
                            <p id="conversion-result" class="text-2xl font-bold text-gray-800">0.000 ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
                        </div>
                    </div>

                    <!-- Right Panel: Stock List -->
                    <div class="lg:col-span-2 dashboard-card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                            <button class="primary-btn px-4 py-2 text-sm">
                                <i data-lucide="plus" class="inline-block w-4 h-4 mr-1"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶Ü‡¶á‡¶°‡¶ø</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶ì‡¶ú‡¶® (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-2 whitespace-nowrap">J-001</td>
                                        <td class="px-4 py-2 whitespace-nowrap">‡ß®‡ß´ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶®‡ßá‡¶ï‡¶≤‡ßá‡¶∏</td>
                                        <td class="px-4 py-2 whitespace-nowrap">25.000g</td>
                                        <td class="px-4 py-2 whitespace-nowrap">5 ‡¶™‡¶ø‡¶∏</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 whitespace-nowrap">J-002</td>
                                        <td class="px-4 py-2 whitespace-nowrap">‡¶°‡¶æ‡¶Ø‡¶º‡¶Æ‡¶®‡ßç‡¶° ‡¶∞‡¶ø‡¶Ç</td>
                                        <td class="px-4 py-2 whitespace-nowrap">4.665g</td>
                                        <td class="px-4 py-2 whitespace-nowrap">12 ‡¶™‡¶ø‡¶∏</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // --- Core Feature: Mortgage Simple Interest Calculator ---
        
        function calculateSimpleInterest() {
            const principal = parseFloat(document.getElementById('principal-input').value) || 0;
            const rate = parseFloat(document.getElementById('rate-input').value) || 0; // Annual Rate
            const duration = parseInt(document.getElementById('duration-input').value) || 0; // Duration in Months

            if (principal <= 0 || rate <= 0 || duration <= 0) {
                 document.getElementById('interest-result').textContent = "‡¶∏‡¶¨ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø)‡•§";
                 document.getElementById('total-payable-result').textContent = "‡ß≥ 0.00";
                 document.getElementById('interest-result').classList.add('text-red-500');
                 return;
            }

            // Simple Interest Formula (for annual rate, convert duration to years)
            const timeInYears = duration / 12;
            const interest = (principal * rate * timeInYears) / 100;
            const totalPayable = principal + interest;

            document.getElementById('interest-result').textContent = `‡ß≥ ${interest.toFixed(2)}`;
            document.getElementById('total-payable-result').textContent = `‡ß≥ ${totalPayable.toFixed(2)}`;
            document.getElementById('interest-result').classList.remove('text-red-500');
            showMessage("‡¶∏‡ßÅ‡¶¶ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", 'success');
        }

        function renderMortgageView() {
            return `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Panel: Simple Interest Calculator -->
                    <div class="lg:col-span-1 dashboard-card p-6 border-l-4 border-blue-500">
                        <h3 class="text-xl font-bold mb-4">‡¶∏‡¶∞‡¶≤ ‡¶∏‡ßÅ‡¶¶ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</h3>
                        <p class="text-sm text-gray-500 mb-4">‡¶Ü‡¶∏‡¶≤ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶æ‡¶≠ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ (Compound ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡¶Ø‡¶º)‡•§</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="principal-input" class="block text-sm font-medium text-gray-700">‡¶Ü‡¶∏‡¶≤ ‡¶ü‡¶æ‡¶ï‡¶æ (‡ß≥)</label>
                                <input type="number" id="principal-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" value="100000">
                            </div>
                            <div>
                                <label for="rate-input" class="block text-sm font-medium text-gray-700">‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (% ‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï)</label>
                                <input type="number" id="rate-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" value="12">
                            </div>
                            <div>
                                <label for="duration-input" class="block text-sm font-medium text-gray-700">‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ï‡¶æ‡¶≤ (‡¶Æ‡¶æ‡¶∏)</label>
                                <input type="number" id="duration-input" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" value="6">
                            </div>
                        </div>

                        <button id="calculate-interest-btn" class="w-full primary-btn bg-blue-600 text-white hover:bg-blue-700 mt-6">
                            <i data-lucide="calculator" class="inline-block w-4 h-4 mr-2"></i> ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg space-y-2">
                            <p class="text-sm text-gray-600">‡¶Æ‡ßã‡¶ü ‡¶∏‡ßÅ‡¶¶:</p>
                            <p id="interest-result" class="text-2xl font-bold text-gray-800">‡ß≥ 0.00</p>
                            <p class="text-sm text-gray-600 border-t pt-2">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡¶Ø‡¶º:</p>
                            <p id="total-payable-result" class="text-2xl font-bold text-blue-600">‡ß≥ 0.00</p>
                        </div>
                    </div>

                    <!-- Right Panel: Mortgage List -->
                    <div class="lg:col-span-2 dashboard-card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                            <button class="primary-btn px-4 py-2 text-sm bg-blue-600 text-white hover:bg-blue-700">
                                <i data-lucide="plus" class="inline-block w-4 h-4 mr-1"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶Ü‡¶∏‡¶≤ (‡ß≥)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                    </tr>
                                </thead>
                                <tbody id="mortgage-table-body" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-2 whitespace-nowrap">‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶ø‡¶Æ</td>
                                        <td class="px-4 py-2 whitespace-nowrap">‡ß≥ 50,000</td>
                                        <td class="px-4 py-2 whitespace-nowrap">2026-01-15</td>
                                        <td class="px-4 py-2 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡¶¨‡ßá‡•§</p>
                    </div>
                </div>
            `;
        }

        // --- Other Module Placeholders ---

        function renderSalesView() {
            return `<div class="dashboard-card p-6">
                <h3 class="text-xl font-bold mb-4">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º, ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ì ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ</h3>
                <p class="text-gray-600">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø: ‡¶è‡¶á ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡¶ü‡¶ø‡¶§‡ßá ‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Ç, ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>
                <!-- POS Interface would go here -->
            </div>`;
        }

        function renderFinanceView() {
             return `<div class="dashboard-card p-6">
                <h3 class="text-xl font-bold mb-4">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ì ‡¶´‡¶ø‡¶®‡¶æ‡¶®‡ßç‡¶∏</h3>
                <p class="text-gray-600">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡¶∞‡¶ï‡ßç‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø: ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞, ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡ßÅ‡¶ï, ‡¶Ü‡¶Ø‡¶º-‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø-‡¶¨‡ßç‡¶∞‡¶æ‡¶û‡ßç‡¶ö ‡¶´‡¶ø‡¶®‡¶æ‡¶®‡ßç‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶∏‡ßã‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ø‡¶§ ‡¶π‡¶¨‡ßá‡•§</p>
                <!-- Ledger/Cash Book UI would go here -->
            </div>`;
        }

        function renderKarigorView() {
             return `<div class="dashboard-card p-6">
                <h3 class="text-xl font-bold mb-4">‡¶ï‡¶æ‡¶∞‡¶ø‡¶ó‡¶∞ ‡¶ì ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                <p class="text-gray-600">‡¶è‡¶á ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡¶ü‡¶ø‡¶§‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶π‡¶£, ‡¶ï‡¶æ‡¶∞‡¶ø‡¶ó‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç‡ßü‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>
                <!-- Karigor Tracking UI would go here -->
            </div>`;
        }

        function renderReportsView() {
             return `<div class="dashboard-card p-6">
                <h3 class="text-xl font-bold mb-4">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h3>
                <p class="text-gray-600">‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡ßá‡¶∞ (‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º, ‡¶∏‡ßç‡¶ü‡¶ï, ‡¶Æ‡¶∞‡ßç‡¶ó‡ßá‡¶ú, ‡¶´‡¶ø‡¶®‡¶æ‡¶®‡ßç‡¶∏) ‡¶â‡¶™‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡¶° ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§ ‡¶¨‡ßÅ‡¶ï‡¶≤‡ßá‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</p>
                <!-- Report filtering and generation UI would go here -->
            </div>`;
        }

        function renderSettingsView() {
             return `<div class="dashboard-card p-6">
                <h3 class="text-xl font-bold mb-4">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ì ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®</h3>
                <p class="text-gray-600">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®/‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®, ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤ ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏‡¶ø‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø‡¶∞ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</p>
                <!-- Customization Forms would go here -->
            </div>`;
        }

        // --- Firestore Data Listeners ---
        
        // This function is where you would place your onSnapshot listeners for real-time data.
        function startModuleListeners() {
            if (!isAuthReady || !db) return;

            // Example: Listening to Inventory (Public Data for all users to see stock)
            const inventoryColRef = collection(db, `artifacts/${appId}/public/data/inventory`);
            onSnapshot(inventoryColRef, (snapshot) => {
                const inventoryList = [];
                snapshot.forEach(doc => {
                    inventoryList.push({ id: doc.id, ...doc.data() });
                });
                // console.log("Inventory Data updated:", inventoryList);
                // Future implementation: Update the Inventory UI table here.
            }, (error) => {
                console.error("Error listening to inventory:", error);
            });
            
            // Example: Listening to User's private data (e.g., Accountant's personal notes)
            if (currentUserRole === 'accountant' && userId !== 'default-user') {
                 const privateNotesRef = collection(db, `artifacts/${appId}/users/${userId}/private_notes`);
                 onSnapshot(privateNotesRef, (snapshot) => {
                    // Handle private data updates
                 }, (error) => {
                    console.error("Error listening to private notes:", error);
                 });
            }
        }


        // --- Event Listeners and Initial Load ---
        
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile sidebar toggle logic
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });
            
            initializeFirebase();
        });

    </script>
</body>
</html>

