<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Jewellery POS – Ultra Gold Royal Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* ------------------------------------------
   GLOBAL GOLD ROYAL THEME
-------------------------------------------*/
:root {
    --gold: #FFD37A;
    --gold-soft: #FFE9B8;
    --gold-hard: #D6A354;
    --dark: #050505;
    --glass: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.12);
}

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(180deg, #000000, #0B0B0B, #101010);
    color: var(--gold-soft);
    min-height: 100vh;
}

/* ------------------------------------------
   HEADER
-------------------------------------------*/
.header {
    padding: 18px 10px;
    text-align: center;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--glass-border);
}

.header-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--gold);
}

.header-tagline {
    font-size: 14px;
    opacity: 0.8;
}

/* ------------------------------------------
   GLASS NAVIGATION BAR
-------------------------------------------*/
.navbar {
    position: sticky;
    top: 0;
    z-index: 50;
    display: flex;
    overflow-x: auto;
    background: rgba(20,20,20,0.55);
    border-bottom: 1px solid var(--glass-border);
    backdrop-filter: blur(10px);
    gap: 6px;
    padding: 10px 6px;
}

.nav-btn {
    flex: 1 1 auto;
    white-space: nowrap;
    padding: 10px 14px;
    font-size: 14px;
    color: var(--gold-soft);
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    border: 1px solid var(--glass-border);
    transition: .25s;
}

.nav-btn:hover {
    background: rgba(255,255,255,0.12);
    color: var(--gold);
}

.nav-btn.active {
    background: linear-gradient(145deg, var(--gold), var(--gold-hard));
    color: #000;
    font-weight: bold;
    border-color: var(--gold-soft);
    box-shadow: 0 3px 10px rgba(255,175,50,0.4);
    transform: translateY(-2px);
}

/* ------------------------------------------
   UNIVERSAL CARD WITH GOLD FRAME + GLASS
-------------------------------------------*/
.gold-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 14px;
    padding: 18px;
    margin: 14px 0;
    box-shadow: 0 0 18px rgba(255,215,140,0.06);
    backdrop-filter: blur(6px);
}

/* ------------------------------------------
   INPUT (Floating Style)
-------------------------------------------*/
.form-group {
    position: relative;
    margin: 14px 0;
}

.form-input {
    width: 100%;
    padding: 12px 14px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--glass-border);
    color: var(--gold);
    border-radius: 8px;
    transition: .3s ease;
}

.form-input:focus {
    border-color: var(--gold);
    background: rgba(0,0,0,0.4);
    box-shadow: 0 0 8px rgba(255,214,120,0.4);
    outline: none;
}

.form-label {
    position: absolute;
    top: -8px;
    left: 14px;
    background: #000;
    padding: 0 6px;
    font-size: 12px;
    color: var(--gold-soft);
}

/* ------------------------------------------
   GOLD BUTTON
-------------------------------------------*/
.btn-gold {
    background: linear-gradient(140deg, var(--gold), var(--gold-hard));
    color: #000;
    font-weight: 700;
    padding: 12px 20px;
    width: 100%;
    border-radius: 10px;
    margin-top: 8px;
    box-shadow: 0 4px 14px rgba(255,200,100,0.35);
    border: none;
    transition: .25s ease;
}
.btn-gold:hover {
    background: linear-gradient(140deg, var(--gold-hard), var(--gold));
    transform: translateY(-2px);
}

/* ------------------------------------------
   PAGE HIDE/SHOW
-------------------------------------------*/
.page {
    display: none;
    padding: 18px;
}
.page.active {
    display: block;
}

/* ------------------------------------------
   TABLE GOLD THEME
-------------------------------------------*/
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background: rgba(255,255,255,0.04);
    border-radius: 10px;
    overflow: hidden;
}
th {
    background: rgba(255,255,255,0.07);
    padding: 10px;
    color: var(--gold);
    font-size: 13px;
}
td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    color: var(--gold-soft);
}

/* ------------------------------------------
   MODAL (GLASS)
-------------------------------------------*/
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 14px;
}
.modal-card {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 14px;
    padding: 20px;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 0 24px rgba(255,210,120,0.2);
}

</style>
</head>

<body>

<!-- =======================================
     HEADER
======================================= -->
<div class="header">
    <h1 class="header-title"><i class="fa-solid fa-gem mr-2"></i> জুয়েলারি POS সিস্টেম</h1>
    <p class="header-tagline">Ultra Gold Royal Premium Edition</p>
</div>

<!-- =======================================
     GLASS NAV (TOP)
======================================= -->
<div class="navbar">
    <button class="nav-btn active" onclick="showPage('dashboard', this)">ড্যাশবোর্ড</button>
    <button class="nav-btn" onclick="showPage('purchase', this)">ক্রয়</button>
    <button class="nav-btn" onclick="showPage('sale', this)">বিক্রয়</button>
    <button class="nav-btn" onclick="showPage('mortgage', this)">বন্ধক</button>
    <button class="nav-btn" onclick="showPage('cash', this)">নগদ</button>
    <button class="nav-btn" onclick="showPage('reports', this)">রিপোর্ট</button>
    <button class="nav-btn" onclick="showPage('party', this)">পার্টি</button>
</div>

<!-- =======================================
     MAIN WRAPPER
======================================= -->

   <!-- =======================================
     PAGE: DASHBOARD
======================================= -->
<div id="dashboard" class="page active">

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-3 text-[var(--gold)]">
            <i class="fa-solid fa-chart-line mr-2"></i> সিস্টেমের সংক্ষিপ্ত তথ্য
        </h2>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">

            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.04)]">
                <p class="text-sm text-gray-300">মোট বিনিয়োগ</p>
                <p id="total-investment" class="text-2xl font-bold text-green-400">৳ ০</p>
            </div>

            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.04)]">
                <p class="text-sm text-gray-300">মোট খরচ</p>
                <p id="total-expense" class="text-2xl font-bold text-red-400">৳ ০</p>
            </div>

            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.04)]">
                <p class="text-sm text-gray-300">বন্ধক বকেয়া</p>
                <p id="dashboard-total-mortgage" class="text-2xl font-bold text-blue-400">৳ ০</p>
            </div>

            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.04)]">
                <p class="text-sm text-gray-300">বন্ধক সুদ</p>
                <p id="dashboard-total-interest" class="text-2xl font-bold text-purple-400">৳ ০</p>
            </div>

        </div>
    </div>


    <!-- GOLD STOCK VIEW -->
    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-3 text-[var(--gold)]">বর্তমান স্বর্ণের স্টক</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

            <div>
                <p class="text-sm text-gray-400">স্টক (গ্রাম)</p>
                <p id="stock-grams" class="text-2xl font-bold text-yellow-300">০.০০ gm</p>
                <p id="stock-vori" class="text-xs text-gray-400">০ ভরি</p>
            </div>

            <div>
                <p class="text-sm text-gray-400">স্টকের বাজার মূল্য</p>
                <p id="stock-market-value" class="text-2xl font-bold text-yellow-300">৳ ০</p>
            </div>

            <div>
                <p class="text-sm mb-1 text-gray-400">স্বর্ণের বাজার মূল্য আপডেট</p>
                <form id="gold-rate-form" class="flex gap-2">
                    <input type="number" id="gold-rate-input"
                        class="form-input" placeholder="ভরি মূল্য">
                    <button class="btn-gold text-sm">আপডেট</button>
                </form>
            </div>

        </div>
    </div>

    <!-- RECENT TRANSACTIONS -->
    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-3 text-[var(--gold)]">সাম্প্রতিক লেনদেন</h2>
        <div class="overflow-x-auto">
            <table>
                <thead>
                    <tr>
                        <th>তারিখ</th>
                        <th>প্রকার</th>
                        <th>টাকা</th>
                        <th>বিবরণ</th>
                    </tr>
                </thead>
                <tbody id="recent-transactions-body">
                    <tr>
                        <td colspan="4" class="text-center text-gray-400">কোন লেনদেন নেই</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- =======================================
     PAGE: PURCHASE (ক্রয়)
======================================= -->
<div id="purchase" class="page">

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-cart-shopping mr-2"></i> স্বর্ণ/গহনা ক্রয়
        </h2>

        <form id="purchase-form">

            <h3 class="text-lg mb-2">ওজন ইনপুট</h3>
            <div class="grid grid-cols-4 gap-3">

                <div class="form-group">
                    <label class="form-label">ভরি</label>
                    <input type="number" id="purchase-vori" class="form-input" value="0">
                </div>

                <div class="form-group">
                    <label class="form-label">আনা</label>
                    <input type="number" id="purchase-ana" class="form-input" value="0">
                </div>

                <div class="form-group">
                    <label class="form-label">রতি</label>
                    <input type="number" id="purchase-roti" class="form-input" value="0">
                </div>

                <div class="form-group">
                    <label class="form-label">পয়েন্ট</label>
                    <input type="number" id="purchase-point" class="form-input" value="0">
                </div>
            </div>

            <p class="text-sm text-gray-300 mt-1">
                মোট গ্রাম: <span id="purchase-grams-output" class="text-yellow-300 font-bold">০</span> |
                মোট ভরি: <span id="purchase-vori-output" class="text-yellow-300 font-bold">০</span>
            </p>

            <div class="form-group">
                <label class="form-label">স্বর্ণের প্রকার</label>
                <input type="text" id="purchase-gold-type" class="form-input" placeholder="যেমন: ২২ ক্যারেট">
            </div>

            <div class="form-group">
                <label class="form-label">প্রতি ভরি মূল্য</label>
                <input type="number" id="purchase-price-per-vori" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">মেকিং চার্জ</label>
                <input type="number" id="purchase-making-charge" class="form-input" value="0">
            </div>

            <div class="form-group">
                <label class="form-label">সরবরাহকারী</label>
                <input type="text" id="purchase-supplier" class="form-input" placeholder="দোকানের নাম">
            </div>

            <p class="text-lg font-bold mt-3">
                মোট মূল্য: <span id="purchase-total-cost" class="text-green-400">৳ ০</span>
            </p>

            <button class="btn-gold mt-4">ক্রয় জমা দিন</button>

        </form>

    </div>

</div>

<!-- =======================================
     PAGE: SALE (বিক্রয়)
======================================= -->
<div id="sale" class="page">

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-bag-shopping mr-2"></i> স্বর্ণ/গহনা বিক্রয়
        </h2>

        <form id="sale-form">

            <h3 class="text-lg mb-2">ওজন ইনপুট</h3>

            <div class="grid grid-cols-4 gap-3">
                <div class="form-group">
                    <label class="form-label">ভরি</label>
                    <input type="number" id="sale-vori" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">আনা</label>
                    <input type="number" id="sale-ana" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">রতি</label>
                    <input type="number" id="sale-roti" class="form-input" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">পয়েন্ট</label>
                    <input type="number" id="sale-point" class="form-input" value="0">
                </div>
            </div>

            <p class="text-sm text-gray-300 mt-1">
                মোট গ্রাম: <span id="sale-grams-output" class="text-yellow-300 font-bold">০</span> |
                মোট ভরি: <span id="sale-vori-output" class="text-yellow-300 font-bold">০</span>
            </p>

            <div class="form-group">
                <label class="form-label">প্রতি ভরি বিক্রয় মূল্য</label>
                <input type="number" id="sale-price-per-vori" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">গ্রাহকের নাম</label>
                <input type="text" id="sale-customer" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">গ্রাহকের ফোন</label>
                <input type="text" id="sale-phone" class="form-input">
            </div>

            <p class="text-lg font-bold mt-3">
                মোট মূল্য: <span id="sale-total-cost" class="text-green-400">৳ ০</span>
            </p>

            <button class="btn-gold mt-4">বিক্রয় জমা দিন</button>

        </form>
    </div>

</div>

<!-- =======================================
     PART 3/4 আসছে…
======================================= --> <!-- =======================================
     PAGE: MORTGAGE (বন্ধক)
======================================= -->
<div id="mortgage" class="page"><!-- =======================================
     Redeem Mortgage Modal
======================================= -->
<div id="redeem-modal" class="modal">
  <div class="modal-card">

    <h2 class="text-lg font-semibold mb-4 text-[var(--gold)]">রিডিম / পরিশোধ</h2>

    <div class="form-group">
        <label class="form-label">ঋণের মোট পরিমাণ</label>
        <input id="redeem-loan" class="form-input" disabled>
    </div>

    <div class="form-group">
        <label class="form-label">মোট সুদ</label>
        <input id="redeem-interest" class="form-input" disabled>
    </div>

    <div class="form-group">
        <label class="form-label">যে পরিমাণ পরিশোধ করবেন</label>
        <input id="redeem-pay" type="number" class="form-input" placeholder="টাকা লিখুন">
    </div>

    <div class="flex justify-end gap-3 mt-4">
        <button 
            type="button"
            onclick="closeRedeemModal()"
            class="px-4 py-2 bg-gray-500 text-white rounded-lg">বাতিল</button>

        <button 
            onclick="submitRedeem()"
            class="btn-gold">পরিশোধ করুন</button>
    </div>

  </div>
</div>

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-hand-holding-dollar mr-2"></i> বন্ধক হিসাব
        </h2>

        <!-- Stats -->
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.05)]">
                <p class="text-sm text-gray-300">মোট বকেয়া মূলধন</p>
                <p id="total-mortgage-value" class="text-2xl font-bold text-blue-400">৳ ০</p>
            </div>
            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.05)]">
                <p class="text-sm text-gray-300">মোট বকেয়া সুদ</p>
                <p id="total-accrued-interest" class="text-2xl font-bold text-purple-400">৳ ০</p>
            </div>
        </div>

        <button onclick="document.getElementById('new-mortgage-modal').style.display='flex'"
            class="btn-gold text-sm">নতুন বন্ধক যোগ করুন</button>

        <!-- MORTGAGE LIST TABLE -->
        <div class="overflow-x-auto mt-6">
            <table>
                <thead>
                    <tr>
                        <th>গ্রাহক</th>
                        <th>ওজন</th>
                        <th>ঋণ</th>
                        <th>সুদ</th>
                        <th>বকেয়া সুদ</th>
                        <th>অ্যাকশন</th>
                    </tr>
                </thead>
                <tbody id="mortgage-list-body">
                    <tr>
                        <td colspan="6" class="text-center text-gray-400">কোনো বন্ধক নেই</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

</div>

<!-- =======================================
     PAGE: CASH / INVESTMENT
======================================= -->
<div id="cash" class="page">

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-money-bill-wave mr-2"></i> নগদ লেনদেন / বিনিয়োগ
        </h2>

        <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.05)]">
                <p class="text-sm">মোট বিনিয়োগ</p>
                <p id="cash-total-investment" class="text-2xl font-bold text-green-400">৳ ০</p>
            </div>
            <div class="p-4 rounded-xl border border-[var(--glass-border)] bg-[rgba(255,255,255,0.05)]">
                <p class="text-sm">মোট খরচ</p>
                <p id="cash-total-expense" class="text-2xl font-bold text-red-400">৳ ০</p>
            </div>
        </div>

        <!-- CASH ENTRY FORM -->
        <form id="cash-transaction-form">

            <div class="form-group">
                <label class="form-label">লেনদেনের ধরন</label>
                <select id="cash-type" class="form-input">
                    <option value="Investment">বিনিয়োগ</option>
                    <option value="Expense">খরচ</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">পরিমাণ</label>
                <input id="cash-amount" type="number" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">বিবরণ</label>
                <textarea id="cash-description" class="form-input"></textarea>
            </div>

            <button class="btn-gold mt-3">সংরক্ষণ করুন</button>
        </form>

        <!-- CASH TABLE -->
        <div class="overflow-x-auto mt-6">
            <table>
                <thead>
                    <tr>
                        <th>তারিখ</th>
                        <th>ধরন</th>
                        <th>পরিমাণ</th>
                        <th>বিবরণ</th>
                    </tr>
                </thead>
                <tbody id="cash-list-body">
                    <tr>
                        <td colspan="4" class="text-center text-gray-400">কোনো লেনদেন নেই</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

</div>

<!-- =======================================
     PAGE: REPORTS (রিপোর্ট)
======================================= -->
<div id="reports" class="page">

    <div class="gold-card">
        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-file-lines mr-2"></i> রিপোর্ট ও বিশ্লেষণ
        </h2>

        <!-- Date Filter -->
        <form id="date-range-form" class="grid grid-cols-2 gap-4">
            <div class="form-group">
                <label class="form-label">শুরুর তারিখ</label>
                <input id="start-date" type="date" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">শেষ তারিখ</label>
                <input id="end-date" type="date" class="form-input">
            </div>

            <button class="btn-gold col-span-2">রিপোর্ট দেখুন</button>
        </form>

        <!-- REPORT OUTPUT -->
        <div id="filtered-report-output"
            class="p-4 mt-6 border border-[var(--glass-border)] rounded-xl">
            <p class="text-gray-400 text-center">তারিখ নির্বাচন করুন।</p>
        </div>

        <!-- FULL TOTALS -->
        <div class="grid grid-cols-2 gap-4 mt-6">

            <div class="p-4 border border-[var(--glass-border)] rounded-xl">
                <p class="text-sm">মোট বিক্রয়</p>
                <p id="report-total-sale-revenue" class="text-xl font-bold text-blue-400">৳ ০</p>
            </div>

            <div class="p-4 border border-[var(--glass-border)] rounded-xl">
                <p class="text-sm">মোট ক্রয়</p>
                <p id="report-total-purchase-cost" class="text-xl font-bold text-red-400">৳ ০</p>
            </div>

            <div class="p-4 border border-[var(--glass-border)] rounded-xl col-span-2 bg-[rgba(255,255,255,0.07)]">
                <p class="text-sm">নেট লাভ/ক্ষতি</p>
                <p id="report-net-profit" class="text-3xl font-bold text-yellow-300">৳ ০</p>
            </div>

        </div>

    </div>

</div>

<!-- =======================================
     PAGE: PARTY (গ্রাহক / সরবরাহকারী)
======================================= -->
<div id="party" class="page">

    <div class="gold-card">

        <h2 class="text-xl font-semibold mb-4 text-[var(--gold)]">
            <i class="fa-solid fa-users mr-2"></i> গ্রাহক / সরবরাহকারী তালিকা
        </h2>

        <div class="form-group">
            <label class="form-label">পার্টির ধরন</label>
            <select id="party-type-filter" class="form-input" onchange="filterPartyList(this.value)">
                <option value="All">সব</option>
                <option value="Customer">গ্রাহক</option>
                <option value="Supplier">সরবরাহকারী</option>
            </select>
        </div>

        <div class="overflow-x-auto mt-6">
            <table>
                <thead>
                    <tr>
                        <th>নাম</th>
                        <th>ধরন</th>
                        <th>মোট লেনদেন</th>
                        <th>ফোন</th>
                    </tr>
                </thead>
                <tbody id="party-list-body">
                    <tr>
                        <td colspan="4" class="text-center text-gray-400">কোনো ডেটা নেই</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

</div>

<!-- =======================================
     New Mortgage Modal (Glass)
======================================= -->
<div id="new-mortgage-modal" class="modal">
    <div class="modal-card">

        <h2 class="text-lg font-semibold mb-4 text-[var(--gold)]">নতুন বন্ধক</h2>

        <form id="new-mortgage-form">

            <div class="form-group">
                <label class="form-label">গ্রাহকের নাম</label>
                <input id="mortgage-customer" type="text" class="form-input">
            </div>

            <h3 class="text-md font-semibold mb-2">ওজন ইনপুট</h3>

            <div class="grid grid-cols-4 gap-3">
                <div class="form-group">
                    <label class="form-label">ভরি</label>
                    <input id="mortgage-vori" type="number" value="0" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">আনা</label>
                    <input id="mortgage-ana" type="number" value="0" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">রতি</label>
                    <input id="mortgage-roti" type="number" value="0" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">পয়েন্ট</label>
                    <input id="mortgage-point" type="number" value="0" class="form-input">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">মূল ঋণ</label>
                <input id="mortgage-amount" type="number" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">মাসিক সুদের হার (%)</label>
                <input id="mortgage-rate" type="number" value="5" class="form-input">
            </div>

            <div class="flex justify-end gap-3 mt-4">
                <button type="button"
                    onclick="document.getElementById('new-mortgage-modal').style.display='none'"
                    class="px-4 py-2 bg-gray-500 text-white rounded-lg">বাতিল</button>

                <button class="btn-gold">সংরক্ষণ</button>
            </div>

        </form>

    </div>
</div><!-- =======================================
     GLOBAL MESSAGE BOX (Top-Right Toast)
======================================= -->
<div id="message-box"
     class="fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white z-50 transition-transform duration-300 transform translate-x-full"
     style="display:none; background-color: #333;">
</div>

<!-- =======================================
     JAVASCRIPT STARTS
======================================= -->
<script type="module">

/* ------------------------------------------
   FIREBASE IMPORTS
------------------------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import {
    getAuth,
    signInAnonymously,
    signInWithCustomToken,
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

import {
    getFirestore,
    doc,
    setDoc,
    addDoc,
    onSnapshot,
    collection,
    query,
    where,
    orderBy,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

setLogLevel("Debug");

/* ------------------------------------------
   GLOBAL VARIABLES
------------------------------------------- */
let app, db, auth;
let userId = null;
let userRole = "Admin";
let isAuthReady = false;

let currentGoldRatePerVori = 0;
let allTransactions = [];
let allParties = {};

const GRAMS_PER_VORI = 11.664;
const ROTI_PER_ANA = 4;
const POINT_PER_ROTI = 6;
const ANA_PER_VORI = 16;
const POINT_PER_VORI = ANA_PER_VORI * ROTI_PER_ANA * POINT_PER_ROTI;

/* ------------------------------------------
   UTILITY FUNCTIONS
------------------------------------------- */

// Show small Toast Message
window.showMessage = function (msg, type = "success") {
    const box = document.getElementById("message-box");
    box.textContent = msg;
    box.style.backgroundColor =
        type === "error"
            ? "#c53030"
            : type === "success"
            ? "#38a169"
            : "#555";

    box.style.display = "block";
    box.style.transform = "translateX(0)";
    setTimeout(() => {
        box.style.transform = "translateX(100%)";
        box.style.display = "none";
    }, 3000);
};

// Convert weight → Grams
function voriToGrams(v, a, r, p) {
    v = parseFloat(v) || 0;
    a = parseFloat(a) || 0;
    r = parseFloat(r) || 0;
    p = parseFloat(p) || 0;

    const totalPoints =
        v * POINT_PER_VORI +
        a * ROTI_PER_ANA * POINT_PER_ROTI +
        r * POINT_PER_ROTI +
        p;

    const totalVori = totalPoints / POINT_PER_VORI;
    return parseFloat((totalVori * GRAMS_PER_VORI).toFixed(3));
}

// Convert weight → Decimal Vori
function voriToDecimal(v, a, r, p) {
    v = parseFloat(v) || 0;
    a = parseFloat(a) || 0;
    r = parseFloat(r) || 0;
    p = parseFloat(p) || 0;

    const totalPoints =
        v * POINT_PER_VORI +
        a * ROTI_PER_ANA * POINT_PER_ROTI +
        r * POINT_PER_ROTI +
        p;

    return parseFloat((totalPoints / POINT_PER_VORI).toFixed(4));
}

// Convert Currency
const formatCurrency = (amount) =>
    (amount || 0)
        .toLocaleString("bn-BD", {
            style: "currency",
            currency: "BDT",
            minimumFractionDigits: 0,
        })
        .replace("৳", "৳ ");

/* ------------------------------------------
   FIREBASE INITIALIZATION
------------------------------------------- */
async function initFirebase() {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    auth = getAuth(app);

    if (__initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
    } else {
        await signInAnonymously(auth);
    }

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            userId = user.uid;
            isAuthReady = true;
            startListeners();
        }
    });
}

/* ------------------------------------------
   REAL-TIME LISTENERS
------------------------------------------- */

// Listen to Gold Rate
function startListeners() {
    onSnapshot(
        doc(db, "artifacts", appId, "public", "data", "config", "gold_rate"),
        (snap) => {
            if (snap.exists()) {
                currentGoldRatePerVori = snap.data().rate || 0;
                document.getElementById("current-gold-rate").textContent =
                    formatCurrency(currentGoldRatePerVori);
            }
        }
    );

    // Listen to transactions
    const q = query(
        collection(db, "artifacts", appId, "public", "data", "transactions"),
        orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snap) => {
        allTransactions = [];
        snap.forEach((doc) => allTransactions.push(doc.data()));
        updateDashboard();
        updateCashTable();
        updateRecentTransactions();
        updatePartyList();
    });

    // Listen to mortgages
    const mq = query(
        collection(db, "artifacts", appId, "public", "data", "mortgages"),
        where("status", "==", "Active")
    );

    onSnapshot(mq, (snap) => {
        updateMortgageTable(snap);
    });
}

/* ------------------------------------------
   UPDATE UI SECTIONS
------------------------------------------- */

// Dashboard info
function updateDashboard() {
    let totalInvestment = 0,
        totalExpense = 0,
        totalPurchase = 0,
        totalSale = 0,
        totalInterest = 0,
        totalStockGrams = 0;

    allTransactions.forEach((t) => {
        if (t.type === "Investment") totalInvestment += t.amount;
        if (t.type === "Expense") totalExpense += t.amount;
        if (t.type === "Purchase") {
            totalPurchase += t.amount;
            totalStockGrams += t.grams;
        }
        if (t.type === "Sale") {
            totalSale += t.amount;
            totalStockGrams -= t.grams;
        }
        if (t.type === "Redeem" && t.details?.interestAmount) {
            totalInterest += t.details.interestAmount;
        }
    });

    document.getElementById("total-investment").textContent =
        formatCurrency(totalInvestment);
    document.getElementById("total-expense").textContent =
        formatCurrency(totalExpense);

    document.getElementById("stock-grams").textContent =
        totalStockGrams.toFixed(3) + " gm";

    const totalVori = totalStockGrams / GRAMS_PER_VORI;

    document.getElementById("stock-market-value").textContent =
        formatCurrency(Math.round(totalVori * currentGoldRatePerVori));

    document.getElementById("stock-vori").textContent =
        totalVori.toFixed(3) + " ভরি";
}

// Recent transactions
function updateRecentTransactions() {
    const body = document.getElementById("recent-transactions-body");
    body.innerHTML = "";

    allTransactions.slice(0, 10).forEach((t) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${new Date(t.timestamp?.toDate()).toLocaleDateString("bn-BD")}</td>
            <td>${t.type_bn || t.type}</td>
            <td>${formatCurrency(t.amount)}</td>
            <td>${t.description}</td>
        `;
        body.appendChild(tr);
    });
}

// Cash table update
function updateCashTable() {
    const body = document.getElementById("cash-list-body");
    body.innerHTML = "";

    allTransactions
        .filter((t) => t.type === "Expense" || t.type === "Investment")
        .forEach((t) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${new Date(t.timestamp?.toDate()).toLocaleDateString("bn-BD")}</td>
                <td>${t.type === "Investment" ? "বিনিয়োগ" : "খরচ"}</td>
                <td>${formatCurrency(t.amount)}</td>
                <td>${t.description}</td>
            `;
            body.appendChild(tr);
        });
}

// Party list
function updatePartyList() {
    allParties = {};
    allTransactions.forEach((t) => {
        if (t.details?.customer) {
            const name = t.details.customer;
            if (!allParties[name]) {
                allParties[name] = {
                    name: name,
                    amount: 0,
                    type: "Customer",
                    phone: t.details.phone || "N/A",
                };
            }
            allParties[name].amount += t.amount;
        }
    });

    const body = document.getElementById("party-list-body");
    body.innerHTML = "";

    Object.values(allParties).forEach((p) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${p.name}</td>
            <td>${p.type}</td>
            <td>${formatCurrency(p.amount)}</td>
            <td>${p.phone}</td>
        `;
        body.appendChild(tr);
    });
}

/* ------------------------------------------
   ADD TRANSACTIONS
------------------------------------------- */
async function addTransaction(data) {
    await addDoc(
        collection(db, "artifacts", appId, "public", "data", "transactions"),
        {
            ...data,
            timestamp: serverTimestamp(),
            userId: userId,
        }
    );
}

/* ------------------------------------------
   FORM SUBMISSIONS
------------------------------------------- */

// Purchase
document.getElementById("purchase-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const V = purchase-vori.value;
    const A = purchase-ana.value;
    const R = purchase-roti.value;
    const P = purchase-point.value;

    const grams = voriToGrams(V, A, R, P);
    const voriDecimal = voriToDecimal(V, A, R, P);

    const amount =
        voriDecimal * parseFloat(purchase-price-per-vori.value || 0) +
        parseFloat(purchase-making-charge.value || 0);

    await addTransaction({
        type: "Purchase",
        type_bn: "ক্রয়",
        grams,
        amount: Math.round(amount),
        description: `ক্রয়: ${voriDecimal.toFixed(2)} ভরি`,
    });

    showMessage("ক্রয় সফলভাবে সংরক্ষণ হয়েছে", "success");
});

// Sale
document.getElementById("sale-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const V = sale-vori.value;
    const A = sale-ana.value;
    const R = sale-roti.value;
    const P = sale-point.value;

    const grams = voriToGrams(V, A, R, P);
    const voriDecimal = voriToDecimal(V, A, R, P);

    const amount = voriDecimal * parseFloat(sale-price-per-vori.value);

    await addTransaction({
        type: "Sale",
        type_bn: "বিক্রয়",
        grams,
        amount: Math.round(amount),
        description: `বিক্রয়: ${voriDecimal.toFixed(2)} ভরি`,
        details: {
            customer: sale-customer.value,
            phone: sale-phone.value,
        },
    });

    showMessage("বিক্রয় এন্ট্রি সফল হয়েছে", "success");
});

// Cash transaction
document
    .getElementById("cash-transaction-form")
    .addEventListener("submit", async (e) => {
        e.preventDefault();

        const type = cash-type.value;
        const amount = parseFloat(cash-amount.value);

        await addTransaction({
            type,
            type_bn: type === "Investment" ? "বিনিয়োগ" : "খরচ",
            amount,
            description: cash-description.value,
        });

        showMessage("লেনদেন সংরক্ষণ হয়েছে", "success");
    });

/* ------------------------------------------
   PAGE NAVIGATION
------------------------------------------- */
window.showPage = function (id, btn) {
    document.querySelectorAll(".page").forEach((p) => (p.style.display = "none"));
    document.getElementById(id).style.display = "block";

    document.querySelectorAll(".nav-btn").forEach((b) =>
        b.classList.remove("active")
    );
    btn.classList.add("active");
};

/* ------------------------------------------
   INIT APP
------------------------------------------- */
window.onload = function () {
    initFirebase();
    showPage("dashboard", document.querySelector(".nav-btn"));
};

</script>

</div> <!-- main wrapper end -->
</body>
</html>
