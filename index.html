<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP ZIP - অ্যাডমিন লগইন</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* কাস্টম গোল্ড থিম */
        .gold-bg { background-color: #FFD700; }
        .gold-text { color: #FFD700; }
        .navy-bg { background-color: #0A1931; }
        .navy-text { color: #0A1931; }
        .card-shadow { box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.05); }
        .lang-toggle-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firestore লগিং ডিবাগ মোডে সেট করা
        setLogLevel('Debug');

        // গ্লোবাল ভ্যারিয়েবল ডিক্লেয়ারেশন (Canvas পরিবেশ থেকে আসা)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-erp-zip';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { /* ফায়ারবেস কনফিগারেশন এখানে যোগ করা হবে */ };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;

        /**
         * ফায়ারবেস ইনিশিয়ালাইজ এবং অথেন্টিকেশন হ্যান্ডেল করে।
         */
        async function initializeFirebase() {
            try {
                // অ্যাপ ইনিশিয়ালাইজ
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase initialized successfully for App ID:", appId);

                // Auth টোকেন ব্যবহার করে লগইন
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                const userId = auth.currentUser?.uid || 'anonymous';
                console.log("Current User ID (for Firestore access):", userId);

                // ডেটাবেস কনফিগারেশন যাচাই ও সেটআপ (Initial Settings)
                await initializeSettings(db, appId, userId);

            } catch (error) {
                console.error("Firebase Initialization or Sign-in Error:", error);
                document.getElementById('message-box').innerHTML = `<p class="text-red-600">ত্রুটি: Firebase সংযোগ স্থাপন ব্যর্থ। ${error.message}</p>`;
            }
        }

        /**
         * প্রাথমিক সিস্টেম সেটিংস সেটআপ বা যাচাই করে।
         */
        async function initializeSettings(db, appId, userId) {
            const settingsPath = `artifacts/${appId}/users/${userId}/systemSettings/config`;
            const docRef = doc(db, settingsPath);

            // যেহেতু এটি একটি নতুন বিল্ড, আমরা প্রাথমিক সেটিংস সেট করে দেব
            const initialData = {
                companyName: "ERP ZIP Solutions",
                logoUrl: "https://placehold.co/150x40/0A1931/FFD700?text=ERP+ZIP",
                defaultBranchId: "main-branch",
                currency: "BDT",
                taxRate: 0.05, // 5%
                lastUpdated: new Date().toISOString()
            };

            try {
                // Firestore-এ সেটিংস সেট করা
                await setDoc(docRef, initialData, { merge: true });
                console.log("Initial settings saved/verified successfully at:", settingsPath);
            } catch (e) {
                console.error("Error setting initial document:", e);
            }
        }

        initializeFirebase();

        // গ্লোবাল ফাংশন তৈরি করা হয়েছে যাতে স্ক্রিপ্ট ট্যাগ ব্যবহার করতে পারে
        window.initializeFirebase = initializeFirebase;

    </script>

    <!-- প্রধান কন্টেইনার -->
    <div class="w-full max-w-sm bg-white rounded-xl p-8 card-shadow">
        
        <!-- ভাষা টগল বাটন -->
        <div class="flex justify-end mb-6">
            <div id="language-toggle" class="flex p-1 navy-bg rounded-full text-sm font-medium lang-toggle-button" onclick="toggleLanguage()">
                <span class="px-3 py-1 text-white rounded-full transition-colors duration-300" data-lang="bn">বাংলা</span>
                <span class="px-3 py-1 text-gray-400 transition-colors duration-300" data-lang="en">English</span>
            </div>
        </div>

        <!-- লোগো এবং শিরোনাম -->
        <div class="text-center mb-8">
            <img src="https://placehold.co/150x40/0A1931/FFD700?text=ERP+ZIP" alt="ERP ZIP Logo" class="h-10 mx-auto mb-3 rounded-md shadow-md">
            <h1 id="app-title" class="text-3xl font-extrabold navy-text">ERP ZIP</h1>
            <p id="tagline" class="text-gray-500 mt-1">Admin Panel</p>
        </div>

        <!-- লগইন ফর্ম -->
        <form id="login-form">
            <div class="mb-5">
                <label for="username" id="label-username" class="block text-sm font-medium navy-text mb-2">ইউজারনেম (Username)</label>
                <input type="text" id="username" name="username" value="Madhab Das" required
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
            </div>
            <div class="mb-6">
                <label for="password" id="label-password" class="block text-sm font-medium navy-text mb-2">পাসওয়ার্ড (Password)</label>
                <input type="password" id="password" name="password" required
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
            </div>

            <button type="submit" id="login-button"
                    class="w-full gold-bg text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-400 focus:outline-none focus:ring-4 focus:ring-yellow-300 transition duration-200 shadow-lg">
                লগইন করুন
            </button>
        </form>

        <!-- বার্তা বক্স -->
        <div id="message-box" class="mt-6 text-center text-sm font-medium text-gray-600">
            ডেটাবেস সংযোগের জন্য অপেক্ষা করা হচ্ছে...
        </div>
        
        <!-- User ID Display (Debugging) -->
        <div id="user-id-display" class="mt-4 text-center text-xs text-gray-400 break-all">
            ইউজার ID: <span id="current-user-id">Loading...</span>
        </div>

    </div>

    <!-- JavaScript লজিক -->
    <script>
        // ডিকশনারি ফর ভাষা সাপোর্ট
        const translations = {
            en: {
                title: "ERP ZIP",
                tagline: "Admin Panel",
                username: "Username",
                password: "Password",
                loginButton: "Login",
                loading: "Waiting for database connection...",
                userId: "User ID:"
            },
            bn: {
                title: "ইআরপি জিপ",
                tagline: "অ্যাডমিন প্যানেল",
                username: "ইউজারনেম",
                password: "পাসওয়ার্ড",
                loginButton: "লগইন করুন",
                loading: "ডেটাবেস সংযোগের জন্য অপেক্ষা করা হচ্ছে...",
                userId: "ইউজার ID:"
            }
        };

        let currentLang = 'bn'; // ডিফল্ট ভাষা বাংলা

        /**
         * ইউজার ইন্টারফেসের ভাষা পরিবর্তন করে।
         * @param {string} lang - নতুন ভাষা ('en' বা 'bn')
         */
        function applyTranslations(lang) {
            const t = translations[lang];
            
            // টাইটেল ও ট্যাগলাইন
            document.title = `ERP ZIP - ${t.tagline}`;
            document.getElementById('app-title').textContent = t.title;
            document.getElementById('tagline').textContent = t.tagline;

            // ফর্ম লেবেল ও বাটন
            document.getElementById('label-username').textContent = `${t.username} (Username)`;
            document.getElementById('label-password').textContent = `${t.password} (Password)`;
            document.getElementById('login-button').textContent = t.loginButton;
            document.getElementById('message-box').textContent = t.loading;
            
            // ইউজার ID ডিসপ্লে
            const userIdSpan = document.getElementById('current-user-id').textContent;
            document.getElementById('user-id-display').innerHTML = `${t.userId} <span id="current-user-id">${userIdSpan}</span>`;

            // টগল বাটনের ভিজ্যুয়াল আপডেট
            const toggleDiv = document.getElementById('language-toggle');
            toggleDiv.querySelector('[data-lang="bn"]').classList.remove('gold-bg', 'text-white');
            toggleDiv.querySelector('[data-lang="bn"]').classList.add('text-gray-400');
            toggleDiv.querySelector('[data-lang="en"]').classList.remove('gold-bg', 'text-white');
            toggleDiv.querySelector('[data-lang="en"]').classList.add('text-gray-400');

            toggleDiv.querySelector(`[data-lang="${lang}"]`).classList.add('gold-bg', 'text-white');
            toggleDiv.querySelector(`[data-lang="${lang}"]`).classList.remove('text-gray-400');

            currentLang = lang;
        }

        /**
         * ভাষা টগল করার ফাংশন।
         */
        function toggleLanguage() {
            const newLang = currentLang === 'bn' ? 'en' : 'bn';
            applyTranslations(newLang);
        }

        // DOM লোড হওয়ার পর ডিফল্ট বাংলা ভাষা সেট করা
        window.onload = () => {
            applyTranslations(currentLang);
            // Firebase Auth State পরিবর্তন মনিটর করার জন্য মকআপ
            setTimeout(() => {
                const userId = window.auth?.currentUser?.uid || 'MdbD-8975-Anon'; 
                document.getElementById('current-user-id').textContent = userId;
                document.getElementById('message-box').textContent = currentLang === 'bn' 
                    ? `ডেটাবেস সংযোগ সফল। ইউজার ID: ${userId}` 
                    : `Database connection successful. User ID: ${userId}`;
            }, 3000);
        };

        // ফর্ম সাবমিশন হ্যান্ডলার
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const messageBox = document.getElementById('message-box');
            
            // Madhab Das-এর জন্য একটি মকআপ লগইন লজিক
            if (username === 'Madhab Das' && password === 'admin123') { 
                const message = currentLang === 'bn' ? "লগইন সফল! ড্যাশবোর্ডে প্রবেশ করা হচ্ছে..." : "Login successful! Redirecting to Dashboard...";
                messageBox.innerHTML = `<p class="text-green-600 font-bold">${message}</p>`;
                // এখানে ড্যাশবোর্ড লোড করার কোড থাকবে
            } else {
                const message = currentLang === 'bn' ? "ইউজারনেম বা পাসওয়ার্ড ভুল।" : "Incorrect username or password.";
                messageBox.innerHTML = `<p class="text-red-600 font-bold">${message}</p>`;
            }
        });

    </script>
</body>
</html>


