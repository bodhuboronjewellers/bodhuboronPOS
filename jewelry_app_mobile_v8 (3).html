<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<title>Jewelry App (Mobile Style V8)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
:root{--primary:#111827;--primary-soft:#1f2937;--accent:#fbbf24;--bg:#020617;--card:#0b1120;--text:#f9fafb;--muted:#9ca3af;--danger:#ef4444;--success:#22c55e;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:radial-gradient(circle at top,#111827,#020617);color:var(--text);height:100vh;display:flex;justify-content:center;align-items:center;}
.app-shell{width:100%;max-width:480px;height:100vh;max-height:900px;background:#020617;border-radius:24px;box-shadow:0 20px 40px rgba(0,0,0,0.6);overflow:hidden;display:flex;flex-direction:column;border:1px solid rgba(148,163,184,0.3);}
.app-bar{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:rgba(15,23,42,0.95);border-bottom:1px solid rgba(148,163,184,0.3);}
.app-title{font-weight:700;font-size:18px;display:flex;align-items:center;gap:8px;}
.app-title span.icon{width:28px;height:28px;border-radius:999px;background:radial-gradient(circle at 30% 30%,#facc15,#f97316);display:flex;align-items:center;justify-content:center;font-size:16px;}
.app-subtitle{font-size:11px;color:var(--muted);}
.app-content{flex:1;overflow-y:auto;padding:12px 12px 70px 12px;}
.bottom-nav{height:62px;background:rgba(15,23,42,0.98);border-top:1px solid rgba(148,163,184,0.3);display:flex;justify-content:space-around;align-items:center;}
.nav-item{flex:1;text-align:center;font-size:11px;color:var(--muted);cursor:pointer;padding-top:4px;}
.nav-item span.icon{display:block;font-size:18px;margin-bottom:2px;}
.nav-item.active{color:var(--accent);}
.section-card{background:radial-gradient(circle at top left,#111827,#020617);border-radius:18px;padding:14px;margin-bottom:12px;border:1px solid rgba(148,163,184,0.25);box-shadow:0 10px 25px rgba(15,23,42,0.8);}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.section-title{font-size:14px;font-weight:600;display:flex;align-items:center;gap:6px;}
.section-title-badge{font-size:9px;padding:2px 6px;border-radius:999px;border:1px solid rgba(148,163,184,0.6);color:var(--muted);}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.form-group{display:flex;flex-direction:column;gap:3px;}
label{font-size:11px;color:var(--muted);}
input,select,textarea{background:rgba(15,23,42,0.9);color:var(--text);border-radius:999px;border:1px solid rgba(148,163,184,0.5);padding:8px 10px;font-size:12px;outline:none;}
textarea{border-radius:12px;min-height:60px;resize:vertical;}
input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 1px rgba(251,191,36,0.5);}
.btn-row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;}
.btn{flex:1;min-width:120px;border:none;border-radius:999px;padding:9px 12px;font-size:13px;font-weight:600;cursor:pointer;}
.btn-primary{background:linear-gradient(to right,#f59e0b,#facc15);color:#111827;}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid rgba(148,163,184,0.6);}
.btn-danger{background:var(--danger);color:white;}
.chips-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
.chip{font-size:10px;padding:4px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.6);color:var(--muted);cursor:pointer;}
.result-box{margin-top:8px;font-size:12px;padding:8px 10px;border-radius:12px;background:rgba(22,163,74,0.12);border:1px solid rgba(34,197,94,0.5);color:#bbf7d0;}
.result-box.error{background:rgba(239,68,68,0.12);border-color:rgba(248,113,113,0.9);color:#fecaca;}
.summary-row{display:flex;justify-content:space-between;margin-top:4px;font-size:11px;color:var(--muted);}
.last-list{margin-top:6px;font-size:11px;color:var(--muted);}
.last-list b{color:var(--text);}
.rep-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:4px;}
.rep-table th,.rep-table td{padding:3px 4px;border-bottom:1px solid rgba(148,163,184,0.25);}
.rep-table th{text-align:left;color:var(--muted);}
.screen{display:none;}
.screen.active{display:block;}
.pill{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:4px 10px;border-radius:999px;background:rgba(15,23,42,0.9);border:1px solid rgba(148,163,184,0.5);margin-bottom:6px;}
#print-area{display:none;}
@media print{body{background:white;}.app-shell{display:none;}#print-area{display:block;font-family:system-ui,sans-serif;color:#000;padding:10px;}#print-area h2{margin-bottom:4px;}#print-area table{width:100%;border-collapse:collapse;font-size:12px;}#print-area th,#print-area td{border:1px solid #000;padding:4px;}}
</style>
</head>
<body>
<div class="app-shell">
  <div class="app-bar">
    <div>
      <div class="app-title">
        <span class="icon">üíé</span>
        <div>Jewelry POS V8</div>
      </div>
      <div class="app-subtitle">
        ‡ß®‡ß®K/‡ß®‡ßßK/‡ßß‡ßÆK ‡¶∞‡ßá‡¶ü + ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ + ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ + ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ + ‡¶∏‡ßç‡¶ü‡¶ï (‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶°) + ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø + ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú + ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ + ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü + ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü + ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞
      </div>
    </div>
    <div class="app-subtitle" id="todayText"></div>
  </div>
  <div class="app-content">
    <div class="screen active" id="screen-home">
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üìä ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</div>
          <span class="section-title-badge">‡¶≤‡¶æ‡¶á‡¶≠</span>
        </div>
        <div class="summary-row">
          <span>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶ü (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø)</span>
          <span id="sumSale">‡ß≥ 0</span>
        </div>
        <div class="summary-row">
          <span>‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶∏‡¶ø‡¶™‡¶æ‡¶≤ (Active)</span>
          <span id="sumMortIn">‡ß≥ 0</span>
        </div>
        <div class="summary-row">
          <span>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú + ‡¶≤‡¶ï‡¶æ‡¶∞ ‡¶°‡¶ø‡¶â (Active)</span>
          <span id="sumMortMonthly">‡ß≥ 0</span>
        </div>
        <div class="summary-row">
          <span>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (Cash In - Out)</span>
          <span id="sumCash">‡ß≥ 0</span>
        </div>
        <div class="summary-row">
          <span>‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</span>
          <span id="sumStock">0</span>
        </div>
        <div class="chips-row">
          <span class="chip">‚ö° ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</span>
          <span class="chip">üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â</span>
          <span class="chip">üíæ LocalStorage ‡¶°‡¶æ‡¶ü‡¶æ</span>
        </div>
      </div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üßæ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ó‡¶æ‡¶á‡¶°</div>
        </div>
        <p style="font-size:12px;color:var(--muted);margin-bottom:4px;">
          ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá <b>‡¶Ü‡¶á‡¶°‡¶ø/‡¶∏‡ßç‡¶ü‡¶ï</b> ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ó‡¶ø‡¶Ø‡¶º‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞, ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤, ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞, ‡¶∏‡ßç‡¶ü‡¶ï (‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° + ‡¶¨‡ßÅ‡¶°‡¶º‡¶ø/‡¶Ü‡¶®‡¶æ/‡¶∞‡¶§‡¶ø/‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü) ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
          ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ <b>‡ß®‡ß®K/‡ß®‡ßßK/‡ßß‡ßÆK ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü</b> ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶∞‡¶™‡¶∞ <b>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø / ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú / ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂</b> ‡¶è ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡¶ø‡¶®,
          ‡¶∂‡ßá‡¶∑‡ßá <b>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</b> ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶ì ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§
        </p>
      </div>
    </div>

    <div class="screen" id="screen-sales">
      <div class="pill">üßæ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø / ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ (‡¶ì‡¶ú‡¶® ‡¶Ö‡¶ü‡ßã ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü + ‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° ‡¶≤‡ßã‡¶° + ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤)</div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‚öôÔ∏è ‡¶∞‡ßá‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (‡ß®‡ß®K / ‡ß®‡ßßK / ‡ßß‡ßÆK)</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø ‡¶∞‡ßá‡¶ü (‡¶è‡¶á ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</label>
            <input type="number" id="rateVori" value="105000" onchange="updateRate()" />
          </div>
          <div class="form-group">
            <label>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∞‡ßá‡¶ü (‡¶Ö‡¶ü‡ßã)</label>
            <input type="text" id="rateGram" readonly />
          </div>
        </div>
        <div class="chips-row">
          <span class="chip" onclick="applySavedRate('22')">‡ß®‡ß®K ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®: <span id="rate22View">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶</span></span>
          <span class="chip" onclick="applySavedRate('21')">‡ß®‡ßßK ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®: <span id="rate21View">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶</span></span>
          <span class="chip" onclick="applySavedRate('18')">‡ßß‡ßÆK ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®: <span id="rate18View">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶</span></span>
        </div>
        <div class="chips-row">
          <span class="chip">‡ßß ‡¶≠‡¶∞‡¶ø = ‡ßß‡ßß.‡ß¨‡ß¨‡ß™ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</span>
          <span class="chip">‡ßß ‡¶Ü‡¶®‡¶æ = ‡ß¶.‡ß≠‡ß®‡ßØ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</span>
          <span class="chip">‡ßß ‡¶∞‡¶§‡¶ø = ‡ß¶.‡ßß‡ß®‡ßß‡ß´ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</span>
          <span class="chip">‡ßß ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü = ‡ß¶.‡ß¶‡ßß ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</span>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üë§ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ / ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ü‡¶æ‡¶á‡¶™</label>
            <select id="sType">
              <option value="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option>
              <option value="‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</option>
            </select>
          </div>
          <div class="form-group">
            <label>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç (‡¶Ö‡¶ü‡ßã ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü)</label>
            <input type="text" id="sBillNo" readonly />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="sCustomerId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: C-001" />
          </div>
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="sCustomer" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡¶π‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶ï‡ßã‡¶°</label>
            <input type="text" id="sItemCode" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: R-001" />
          </div>
          <div class="form-group">
            <label>‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶ü‡ßã ‡¶ï‡¶Æ‡¶¨‡ßá?</label>
            <select id="sAffectStock">
              <option value="yes">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å (‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø/‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø)</option>
              <option value="no">‡¶®‡¶æ (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞/‡¶π‡ßã‡¶≤‡ßç‡¶°)</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° / ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡ßã‡¶° (‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶°)</label>
          <input type="text" id="sBarcode" placeholder="‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" onchange="loadStockFromBarcode()" />
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ / ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ</label>
          <input type="text" id="sDesc" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß®‡ß® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü ‡¶∞‡¶ø‡¶Ç" />
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‚öñÔ∏è ‡¶ì‡¶ú‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="sVori" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶Ü‡¶®‡¶æ</label>
            <input type="number" id="sAna" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶∞‡¶§‡¶ø</label>
            <input type="number" id="sRoti" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</label>
            <input type="number" id="sPoint" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø)</label>
            <input type="number" id="sGram" step="0.001" />
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üí∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ì‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶ú %</label>
            <input type="number" id="sWaste" value="5" />
          </div>
          <div class="form-group">
            <label>‡¶Æ‡ßá‡¶ï‡¶ø‡¶Ç ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</label>
            <input type="number" id="sMaking" value="250" />
          </div>
          <div class="form-group">
            <label>‡¶∏‡ßç‡¶ü‡ßã‡¶® ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label>
            <input type="number" id="sStone" value="0" />
          </div>
          <div class="form-group">
            <label>‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü (‡ß≥)</label>
            <input type="number" id="sDiscount" value="0" />
          </div>
          <div class="form-group">
            <label>‡¶®‡¶ó‡¶¶ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß</label>
            <input type="number" id="sPaid" value="0" />
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost" type="button" onclick="clearSaleForm()">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
          <button class="btn btn-primary" type="button" onclick="saveSale()">‡¶∏‡ßá‡¶≠ ‚úÖ</button>
          <button class="btn btn-ghost" type="button" onclick="printLastBill()">üñ® ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤</button>
        </div>
        <div id="saleResult"></div>
        <div id="saleLast" class="last-list"></div>
      </div>
    </div>

    <div class="screen" id="screen-mortgage">
      <div class="pill">üè¶ ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú + ‡¶≤‡¶ï‡¶æ‡¶∞ (‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨)</div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üë§ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="mCustomerId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: C-010" />
          </div>
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="mCustomer" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Ü‡¶≤‡¶Æ‡¶ó‡ßÄ‡¶∞ ‡¶π‡ßã‡¶∏‡ßá‡¶®" />
          </div>
        </div>
        <div class="form-group">
          <label>‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶∏‡ßç‡¶≤‡¶ø‡¶™/‡¶®‡¶Ç</label>
          <input type="text" id="mSlip" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: M-001" />
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
          <input type="text" id="mDesc" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß®‡ß® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ü ‡¶¨‡¶æ‡¶≤‡¶æ" />
        </div>
      </div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‚öñÔ∏è ‡¶ì‡¶ú‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="mVori" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶Ü‡¶®‡¶æ</label>
            <input type="number" id="mAna" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶∞‡¶§‡¶ø</label>
            <input type="number" id="mRoti" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</label>
            <input type="number" id="mPoint" step="0.01" />
          </div>
          <div class="form-group">
            <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</label>
            <input type="number" id="mGram" step="0.001" />
          </div>
        </div>
      </div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üí∞ ‡¶≤‡ßã‡¶® + ‡¶≤‡¶ï‡¶æ‡¶∞ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏)</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
            <input type="number" id="mLoan" />
          </div>
          <div class="form-group">
            <label>‡¶∏‡ßÅ‡¶¶ % (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏)</label>
            <input type="number" id="mInterest" value="2" />
          </div>
          <div class="form-group">
            <label>‡¶≤‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏)</label>
            <input type="number" id="mLocker" value="0" />
          </div>
          <div class="form-group">
            <label>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</label>
            <select id="mStatus">
              <option value="Active">Active</option>
              <option value="Closed">Closed</option>
            </select>
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost" type="button" onclick="clearMortgageForm()">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
          <button class="btn btn-primary" type="button" onclick="saveMortgage()">‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="mortgageResult"></div>
        <div id="mortgageLast" class="last-list"></div>
      </div>
    </div>

    <div class="screen" id="screen-cash">
      <div class="pill">üí∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶∞‡ßç‡¶Æ</div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</div>
        </div>
        <div class="form-group">
          <label>‡¶ß‡¶∞‡¶®</label>
          <select id="cType">
            <option value="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option>
            <option value="‡¶ñ‡¶∞‡¶ö">‡¶ñ‡¶∞‡¶ö</option>
            <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
          <textarea id="cDesc" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶ø‡¶≤ 0001 ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ó‡¶¶ / ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶ñ‡¶∞‡¶ö"></textarea>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶®‡¶ó‡¶¶ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ (Cash In)</label>
            <input type="number" id="cIn" />
          </div>
          <div class="form-group">
            <label>‡¶®‡¶ó‡¶¶ ‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶ó‡¶Æ‡¶® (Cash Out)</label>
            <input type="number" id="cOut" />
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost" type="button" onclick="clearCashForm()">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
          <button class="btn btn-primary" type="button" onclick="saveCash()">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="cashResult"></div>
      </div>
    </div>

    <div class="screen" id="screen-settings">
      <div class="pill">üßæ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ / ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ / ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ / ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø + ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü</div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üë§ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="custId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: C-001" />
          </div>
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="custName" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
            <input type="text" id="custMobile" />
          </div>
          <div class="form-group">
            <label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
            <input type="text" id="custAddress" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶õ‡¶¨‡¶ø (‡¶≤‡¶ø‡¶Ç‡¶ï / ‡¶®‡ßã‡¶ü)</label>
            <input type="text" id="custPhoto" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶¨‡¶ø ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶Ç‡¶ï" />
          </div>
          <div class="form-group">
            <label>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶ú‡¶Æ‡¶æ (‡ß≥)</label>
            <input type="number" id="custAdvance" value="0" />
          </div>
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶æ‡¶ï‡¶ø (‡ß≥)</label>
          <input type="number" id="custDue" value="0" />
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="saveCustomer()">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="custResult"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üè† ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ / ‡¶®‡¶ø‡ßü‡¶Æ‡¶ø‡¶§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="locId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: L-001" />
          </div>
          <div class="form-group">
            <label>‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="locName" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
            <input type="text" id="locMobile" />
          </div>
          <div class="form-group">
            <label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
            <input type="text" id="locAddress" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶õ‡¶¨‡¶ø (‡¶≤‡¶ø‡¶Ç‡¶ï / ‡¶®‡ßã‡¶ü)</label>
            <input type="text" id="locPhoto" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶¨‡¶ø ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶Ç‡¶ï" />
          </div>
          <div class="form-group">
            <label>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶ú‡¶Æ‡¶æ (‡ß≥)</label>
            <input type="number" id="locAdvance" value="0" />
          </div>
        </div>
        <div class="form-group">
          <label>‡¶¨‡¶æ‡¶ï‡¶ø (‡ß≥)</label>
          <input type="number" id="locDue" value="0" />
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="saveLocal()">‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="locResult"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üè≠ ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="supId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: S-001" />
          </div>
          <div class="form-group">
            <label>‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="supName" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label>
            <input type="text" id="supMobile" />
          </div>
          <div class="form-group">
            <label>‡¶®‡ßã‡¶ü</label>
            <input type="text" id="supNote" />
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="saveSupplier()">‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="supResult"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üì¶ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ (‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° + ‡¶¨‡ßÅ‡¶°‡¶º‡¶ø/‡¶Ü‡¶®‡¶æ/‡¶∞‡¶§‡¶ø/‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶ï‡ßã‡¶°</label>
            <input type="text" id="stCode" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: R-001" />
          </div>
          <div class="form-group">
            <label>‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="stName" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° / ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡ßã‡¶°</label>
            <input type="text" id="stBarcode" placeholder="‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®" />
          </div>
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∞‡ßá‡¶ü</label>
            <input type="text" id="stKarat" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß®‡ß®K" />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="stVori" step="0.01" oninput="updateStockGram()" />
          </div>
          <div class="form-group">
            <label>‡¶Ü‡¶®‡¶æ</label>
            <input type="number" id="stAna" step="0.01" oninput="updateStockGram()" />
          </div>
          <div class="form-group">
            <label>‡¶∞‡¶§‡¶ø</label>
            <input type="number" id="stRoti" step="0.01" oninput="updateStockGram()" />
          </div>
          <div class="form-group">
            <label>‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</label>
            <input type="number" id="stPoint" step="0.01" oninput="updateStockGram()" />
          </div>
          <div class="form-group">
            <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø)</label>
            <input type="number" id="stGram" step="0.001" oninput="updateStockGram()" />
          </div>
        </div>
        <div class="form-group">
          <label>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶Ö‡¶ü‡ßã ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü)</label>
          <input type="text" id="stGramTotal" readonly />
        </div>
        <div class="form-group">
          <label>‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
          <input type="text" id="stSupId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: S-001" />
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="saveStock()">‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div id="stockResult"></div>
        <div id="stockLast" class="last-list"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‚ú® ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (‡ß®‡ß®K / ‡ß®‡ßßK / ‡ßß‡ßÆK)</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡ß®‡ß®K ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="g22Vori" />
          </div>
          <div class="form-group">
            <label>‡ß®‡ß®K ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶Ö‡¶ü‡ßã)</label>
            <input type="text" id="g22Gram" readonly />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡ß®‡ßßK ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="g21Vori" />
          </div>
          <div class="form-group">
            <label>‡ß®‡ßßK ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶Ö‡¶ü‡ßã)</label>
            <input type="text" id="g21Gram" readonly />
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡ßß‡ßÆK ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≠‡¶∞‡¶ø</label>
            <input type="number" id="g18Vori" />
          </div>
          <div class="form-group">
            <label>‡ßß‡ßÆK ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ (‡¶Ö‡¶ü‡ßã)</label>
            <input type="text" id="g18Gram" readonly />
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="saveGoldRateSettings()">‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‚úÖ</button>
        </div>
        <div class="last-list">
          <b>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞:</b> ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡ßá‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶â‡¶™‡¶∞‡ßá ‡ß®‡ß®K/‡ß®‡ßßK/‡ßß‡ßÆK ‡¶ö‡¶ø‡¶™‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶∏‡ßá‡¶á ‡¶∞‡ßá‡¶ü ‡¶Ö‡¶ü‡ßã ‡¶¨‡¶∏‡¶¨‡ßá‡•§
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‚ö† ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ / ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost" type="button" onclick="exportData()">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ (‡¶ï‡¶™‡¶ø/‡¶™‡ßá‡¶∏‡ßç‡¶ü)</button>
          <button class="btn btn-danger" type="button" onclick="resetAll()">‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
        </div>
        <div id="exportBox" class="last-list"></div>
      </div>
    </div>

    <div class="screen" id="screen-report">
      <div class="pill">üìë ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü (Sales + Mortgage + Cash + Stock + ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞)</div>
      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üë§ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</label>
            <input type="text" id="ledCustId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: C-001" />
          </div>
          <div class="form-group">
            <label>&nbsp;</label>
            <button class="btn btn-primary" type="button" onclick="loadLedger()">‡¶≤‡ßá‡¶ú‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
          </div>
        </div>
        <div id="ledgerBox" class="last-list"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∞‡ßá‡¶û‡ßç‡¶ú</div>
        </div>
        <div class="form-group">
          <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</label>
          <select id="repRange" onchange="renderReport()">
            <option value="today">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞</option>
            <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ</option>
          </select>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üßæ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
        </div>
        <div id="repSales"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üè¶ ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
        </div>
        <div id="repMort"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üí∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
        </div>
        <div id="repCash"></div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-title">üì¶ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡ßç‡¶®‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶ü</div>
        </div>
        <div id="repStock"></div>
      </div>
    </div>

  </div>

  <div class="bottom-nav">
    <div class="nav-item active" data-target="home" onclick="switchScreen('home', this)">
      <span class="icon">üè†</span>
      Home
    </div>
    <div class="nav-item" data-target="sales" onclick="switchScreen('sales', this)">
      <span class="icon">üßæ</span>
      ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø
    </div>
    <div class="nav-item" data-target="mortgage" onclick="switchScreen('mortgage', this)">
      <span class="icon">üè¶</span>
      ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú
    </div>
    <div class="nav-item" data-target="cash" onclick="switchScreen('cash', this)">
      <span class="icon">üí∞</span>
      ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂
    </div>
    <div class="nav-item" data-target="settings" onclick="switchScreen('settings', this)">
      <span class="icon">üì¶</span>
      ‡¶Ü‡¶á‡¶°‡¶ø/‡¶∏‡ßç‡¶ü‡¶ï
    </div>
    <div class="nav-item" data-target="report" onclick="switchScreen('report', this)">
      <span class="icon">üìë</span>
      ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
    </div>
  </div>
</div>

<div id="print-area"></div>

<script>
function formatCurrency(num){if(isNaN(num))return "‡ß≥ 0";return "‡ß≥ " + num.toFixed(2);}
function convertToGram(v,a,r,p,g){return (v*11.664)+(a*0.729)+(r*0.1215)+(p*0.01)+g;}
function isToday(ts){const d=new Date(ts);const t=new Date();return d.getFullYear()===t.getFullYear()&&d.getMonth()===t.getMonth()&&d.getDate()===t.getDate();}
(function setTodayText(){const el=document.getElementById("todayText");const d=new Date();try{el.textContent=d.toLocaleDateString('bn-BD',{day:'2-digit',month:'2-digit',year:'numeric'});}catch(e){el.textContent=d.toLocaleDateString();}})();
const KEY_SALES='jewelry_sales';const KEY_MORTGAGE='jewelry_mortgages';const KEY_CASH='jewelry_cash';const KEY_CUSTOMERS='jewelry_customers';const KEY_SUPPLIERS='jewelry_suppliers';const KEY_STOCK='jewelry_stock';const KEY_LOCALS='jewelry_locals';const KEY_BILL_COUNTER='jewelry_bill_counter';
function getArray(key){const raw=localStorage.getItem(key);if(!raw)return[];try{return JSON.parse(raw);}catch(e){return[];}}
function setArray(key,arr){localStorage.setItem(key,JSON.stringify(arr));}
let lastSaleForPrint=null;
function updateRate(){let vori=parseFloat(document.getElementById("rateVori").value)||0;const perGram=vori/11.664;document.getElementById("rateGram").value=perGram?perGram.toFixed(2):"";localStorage.setItem('gold_rate_vori',vori.toString());localStorage.setItem('gold_rate_gram',perGram.toString());}
function loadMultiKaratRatesToChips(){const defaults={"22":105000,"21":100000,"18":80000};['22','21','18'].forEach(k=>{let v=parseFloat(localStorage.getItem('rate'+k)||"0");if(!v){v=defaults[k];localStorage.setItem('rate'+k,v);localStorage.setItem('rate'+k+'_g',v/11.664);}let g=parseFloat(localStorage.getItem('rate'+k+'_g')||"0");if(!g){g=v/11.664;localStorage.setItem('rate'+k+'_g',g);}const el=document.getElementById('rate'+k+'View');if(el){el.textContent='‡ß≥'+v.toFixed(0)+' / '+g.toFixed(2)+'/g';}});}
function applySavedRate(k){const v=parseFloat(localStorage.getItem('rate'+k)||"0");const g=parseFloat(localStorage.getItem('rate'+k+'_g')||"0");if(!v||!g){alert('‡¶Ü‡¶ó‡ßá Settings ‚Üí ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü ‡¶•‡ßá‡¶ï‡ßá '+k+'K ‡¶∞‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');return;}document.getElementById("rateVori").value=v.toFixed(0);document.getElementById("rateGram").value=g.toFixed(2);localStorage.setItem('gold_rate_vori',v.toString());localStorage.setItem('gold_rate_gram',g.toString());}
function loadGoldRateSettings(){const defaults={"22":105000,"21":100000,"18":80000};['22','21','18'].forEach(k=>{const voriInput=document.getElementById('g'+k+'Vori');const gramInput=document.getElementById('g'+k+'Gram');if(!voriInput||!gramInput)return;let v=parseFloat(localStorage.getItem('rate'+k)||"0");if(!v)v=defaults[k];const g=v/11.664;voriInput.value=v.toFixed(0);gramInput.value=g.toFixed(2);});}
function saveGoldRateSettings(){['22','21','18'].forEach(k=>{const voriInput=document.getElementById('g'+k+'Vori');const gramInput=document.getElementById('g'+k+'Gram');if(!voriInput||!gramInput)return;let v=parseFloat(voriInput.value)||0;let g=v/11.664;gramInput.value=g?g.toFixed(2):"";localStorage.setItem('rate'+k,v);localStorage.setItem('rate'+k+'_g',g);});loadMultiKaratRatesToChips();alert('‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶∞‡ßá‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');}
(function initRate(){let v=parseFloat(localStorage.getItem('gold_rate_vori')||"0");let g=parseFloat(localStorage.getItem('gold_rate_gram')||"0");if(!v||!g){let v22=parseFloat(localStorage.getItem('rate22')||"0");if(!v22)v22=105000;let g22=v22/11.664;v=v22;g=g22;localStorage.setItem('gold_rate_vori',v.toString());localStorage.setItem('gold_rate_gram',g.toString());localStorage.setItem('rate22',v22);localStorage.setItem('rate22_g',g22);}const voriEl=document.getElementById("rateVori");const gramEl=document.getElementById("rateGram");if(voriEl)voriEl.value=v.toFixed(0);if(gramEl)gramEl.value=g.toFixed(2);loadMultiKaratRatesToChips();prepareBillNo();updateSummary();})();
function switchScreen(name,navEl){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById('screen-'+name).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));navEl.classList.add('active');if(name==='sales'){prepareBillNo();renderLastSales();loadMultiKaratRatesToChips();}if(name==='mortgage'){renderLastMortgages();}if(name==='settings'){renderLastStock();loadGoldRateSettings();loadMultiKaratRatesToChips();}if(name==='report'){renderReport();}}
function prepareBillNo(){let counter=parseInt(localStorage.getItem(KEY_BILL_COUNTER)||"0");const next=counter+1;const el=document.getElementById("sBillNo");if(el){el.value="B-"+String(next).padStart(4,'0');}}
function autoApplyRateByKarat(karat){if(!karat)return;const k=karat.toString().replace(/\s/g,'');if(/22/.test(k)||/‡ß®‡ß®/.test(k))applySavedRate('22');else if(/21/.test(k)||/‡ß®‡ßß/.test(k))applySavedRate('21');else if(/18/.test(k)||/‡ßß‡ßÆ/.test(k))applySavedRate('18');}
function loadStockFromBarcode(){const bcEl=document.getElementById("sBarcode");if(!bcEl)return;const code=bcEl.value.trim();if(!code)return;const stock=getArray(KEY_STOCK);const item=stock.find(it=>(it.barcode||'').toLowerCase()===code.toLowerCase());if(!item){alert('‡¶è‡¶á ‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶ü‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§');return;}document.getElementById("sItemCode").value=item.code||"";document.getElementById("sDesc").value=item.name||"";document.getElementById("sVori").value=item.vori||"";document.getElementById("sAna").value=item.ana||"";document.getElementById("sRoti").value=item.roti||"";document.getElementById("sPoint").value=item.point||"";const g=parseFloat(item.gramDirect||item.gram||0);if(!isNaN(g)&&g>0){document.getElementById("sGram").value=g.toFixed(3);}autoApplyRateByKarat(item.karat||"");document.getElementById("saleResult").innerHTML='<div class="result-box">üì¶ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: '+(item.code||'')+' - '+(item.name||'')+'</div>';}
function clearSaleForm(){['sCustomer','sDesc','sVori','sAna','sRoti','sPoint','sGram','sStone','sDiscount','sPaid','sCustomerId','sItemCode','sBarcode'].forEach(id=>{const el=document.getElementById(id);if(el)el.value="";});document.getElementById("sWaste").value=5;document.getElementById("sMaking").value=250;document.getElementById("sType").value="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø";document.getElementById("sAffectStock").value="yes";document.getElementById("saleResult").innerHTML="";prepareBillNo();}
function saveSale(){const rateG=parseFloat(document.getElementById("rateGram").value)||0;const v=parseFloat(document.getElementById("sVori").value)||0;const a=parseFloat(document.getElementById("sAna").value)||0;const r=parseFloat(document.getElementById("sRoti").value)||0;const p=parseFloat(document.getElementById("sPoint").value)||0;const g=parseFloat(document.getElementById("sGram").value)||0;const totalGram=convertToGram(v,a,r,p,g);if(!totalGram||!rateG){document.getElementById("saleResult").innerHTML='<div class="result-box error">‚ö† ‡¶ì‡¶ú‡¶® ‡¶ì ‡¶∞‡ßá‡¶ü ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const goldValue=totalGram*rateG;const wastePercent=parseFloat(document.getElementById("sWaste").value)||0;const makingRate=parseFloat(document.getElementById("sMaking").value)||0;const stone=parseFloat(document.getElementById("sStone").value)||0;const discount=parseFloat(document.getElementById("sDiscount").value)||0;const paid=parseFloat(document.getElementById("sPaid").value)||0;const wasteValue=goldValue*(wastePercent/100);const making=totalGram*makingRate;const gross=goldValue+wasteValue+making+stone;const net=gross-discount;const due=net-paid;const entryType=document.getElementById("sType").value;const billNo=document.getElementById("sBillNo").value;const affectStock=document.getElementById("sAffectStock").value==="yes";const sale={ts:Date.now(),billNo,type:entryType,customerId:document.getElementById("sCustomerId").value||"",customer:document.getElementById("sCustomer").value||"",itemCode:document.getElementById("sItemCode").value||"",barcode:document.getElementById("sBarcode").value||"",desc:document.getElementById("sDesc").value||"",totalGram,goldValue,wasteValue,making,stone,discount,net,paid,due,rateGram:rateG,wastePercent,makingRate,affectStock};const arr=getArray(KEY_SALES);arr.push(sale);setArray(KEY_SALES,arr);let counter=parseInt(localStorage.getItem(KEY_BILL_COUNTER)||"0");counter+=1;localStorage.setItem(KEY_BILL_COUNTER,String(counter));if(sale.itemCode&&affectStock){const stockArr=getArray(KEY_STOCK);const idx=stockArr.findIndex(it=>(it.code||"").toLowerCase()===sale.itemCode.toLowerCase());if(idx>=0){stockArr[idx].gram=(parseFloat(stockArr[idx].gram)||0)-sale.totalGram;if(stockArr[idx].gram<0)stockArr[idx].gram=0;setArray(KEY_STOCK,stockArr);}}lastSaleForPrint=sale;document.getElementById("saleResult").innerHTML='<div class="result-box">'+'‚úî '+entryType+' ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶¨‡¶ø‡¶≤: '+billNo+')<br>'+'‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: '+totalGram.toFixed(3)+'<br>'+'‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: '+goldValue.toFixed(2)+'<br>'+'‡¶ì‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶ú: '+wasteValue.toFixed(2)+'<br>'+'‡¶Æ‡ßá‡¶ï‡¶ø‡¶Ç: '+making.toFixed(2)+'<br>'+'‡¶∏‡ßç‡¶ü‡ßã‡¶®: '+stone.toFixed(2)+'<br>'+'‡¶Æ‡ßã‡¶ü: '+gross.toFixed(2)+'<br>'+'‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: '+discount.toFixed(2)+'<br>'+'<b>‡¶®‡ßá‡¶ü: '+net.toFixed(2)+' | ‡¶®‡¶ó‡¶¶: '+paid.toFixed(2)+' | ‡¶¨‡¶æ‡¶ï‡¶ø: '+due.toFixed(2)+'</b>'+'</div>';prepareBillNo();updateSummary();renderLastSales();}
function printLastBill(){const s=lastSaleForPrint;if(!s){alert('‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§');return;}const d=new Date(s.ts);const shopName='‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡ßÅ‡ßü‡ßá‡¶≤‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ';const shopAddr='‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: .................. ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ..................';const html=`<h2>${shopName}</h2><div style="font-size:12px;margin-bottom:6px;">${shopAddr}</div><hr /><div style="font-size:12px;margin:4px 0;"><b>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç:</b> ${s.billNo} &nbsp; | &nbsp;<b>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</b> ${d.toLocaleDateString()}<br/><b>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞:</b> ${s.customer||''} (${s.customerId||''})</div><table><thead><tr><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶ì‡¶ú‡¶® (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</th><th>‡¶∞‡ßá‡¶ü/‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</th><th>‡¶ó‡ßã‡¶≤‡ßç‡¶°</th><th>‡¶ì‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶ú</th><th>‡¶Æ‡ßá‡¶ï‡¶ø‡¶Ç</th><th>‡¶∏‡ßç‡¶ü‡ßã‡¶®</th></tr></thead><tbody><tr><td>${s.desc||''}</td><td>${s.totalGram.toFixed(3)}</td><td>${s.rateGram.toFixed(2)}</td><td>${s.goldValue.toFixed(2)}</td><td>${s.wasteValue.toFixed(2)}</td><td>${s.making.toFixed(2)}</td><td>${s.stone.toFixed(2)}</td></tr></tbody></table><br/><table><tbody><tr><td><b>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</b></td><td>${(s.goldValue+s.wasteValue+s.making+s.stone).toFixed(2)}</td></tr><tr><td>‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</td><td>${s.discount.toFixed(2)}</td></tr><tr><td><b>‡¶®‡ßá‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</b></td><td><b>${s.net.toFixed(2)}</b></td></tr><tr><td>‡¶®‡¶ó‡¶¶ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß</td><td>${s.paid.toFixed(2)}</td></tr><tr><td><b>‡¶¨‡¶æ‡¶ï‡¶ø</b></td><td><b>${s.due.toFixed(2)}</b></td></tr></tbody></table><br/><div style="font-size:12px;margin-top:10px;">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞: ____________________________</div>`;const area=document.getElementById('print-area');area.innerHTML=html;window.print();}
function clearMortgageForm(){['mCustomer','mDesc','mVori','mAna','mRoti','mPoint','mGram','mLoan','mInterest','mLocker','mCustomerId','mSlip'].forEach(id=>{const el=document.getElementById(id);if(el)el.value="";});document.getElementById("mInterest").value=2;document.getElementById("mStatus").value="Active";document.getElementById("mortgageResult").innerHTML="";}
function saveMortgage(){const v=parseFloat(document.getElementById("mVori").value)||0;const a=parseFloat(document.getElementById("mAna").value)||0;const r=parseFloat(document.getElementById("mRoti").value)||0;const p=parseFloat(document.getElementById("mPoint").value)||0;const g=parseFloat(document.getElementById("mGram").value)||0;const totalGram=convertToGram(v,a,r,p,g);const loan=parseFloat(document.getElementById("mLoan").value)||0;const intRate=parseFloat(document.getElementById("mInterest").value)||0;const locker=parseFloat(document.getElementById("mLocker").value)||0;const status=document.getElementById("mStatus").value;if(!loan||!totalGram){document.getElementById("mortgageResult").innerHTML='<div class="result-box error">‚ö† ‡¶ì‡¶ú‡¶® ‡¶ì ‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const monthlyInterest=loan*(intRate/100);const monthlyTotal=monthlyInterest+locker;const mg={ts:Date.now(),slip:document.getElementById("mSlip").value||"",status,customerId:document.getElementById("mCustomerId").value||"",customer:document.getElementById("mCustomer").value||"",desc:document.getElementById("mDesc").value||"",totalGram,loan,interestRate:intRate,lockerMonthly:locker,monthlyInterest,monthlyTotal};const arr=getArray(KEY_MORTGAGE);arr.push(mg);setArray(KEY_MORTGAGE,arr);document.getElementById("mortgageResult").innerHTML='<div class="result-box">'+'‚úî ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú '+(status==='Active'?'(‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®)':'(‡¶¨‡¶®‡ßç‡¶ß)')+' ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá<br>'+'‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: '+totalGram.toFixed(3)+'<br>'+'‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: '+loan.toFixed(2)+'<br>'+'‡¶∏‡ßÅ‡¶¶ % (‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï): '+intRate.toFixed(2)+'<br>'+'‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¶: '+monthlyInterest.toFixed(2)+'<br>'+'‡¶≤‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶°‡¶º‡¶æ (‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï): '+locker.toFixed(2)+'<br>'+'<b>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏ ‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá: '+monthlyTotal.toFixed(2)+'</b>'+'</div>';updateSummary();renderLastMortgages();}
function clearCashForm(){['cDesc','cIn','cOut'].forEach(id=>{const el=document.getElementById(id);if(el)el.value="";});document.getElementById("cType").value="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø";document.getElementById("cashResult").innerHTML="";}
function saveCash(){const type=document.getElementById("cType").value;const desc=document.getElementById("cDesc").value;const cin=parseFloat(document.getElementById("cIn").value)||0;const cout=parseFloat(document.getElementById("cOut").value)||0;if(!cin&&!cout){document.getElementById("cashResult").innerHTML='<div class="result-box error">‚ö† Cash In ‡¶¨‡¶æ Cash Out ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const tx={ts:Date.now(),type,desc,cin,cout};const arr=getArray(KEY_CASH);arr.push(tx);setArray(KEY_CASH,arr);document.getElementById("cashResult").innerHTML='<div class="result-box">‚úî ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá<br>‡¶ß‡¶∞‡¶®: '+type+'</div>';updateSummary();}
function saveCustomer(){const id=document.getElementById("custId").value.trim();const name=document.getElementById("custName").value.trim();if(!id||!name){document.getElementById("custResult").innerHTML='<div class="result-box error">‚ö† ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ì ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const cust={id,name,mobile:document.getElementById("custMobile").value.trim(),address:document.getElementById("custAddress").value.trim(),photo:document.getElementById("custPhoto").value.trim(),advance:parseFloat(document.getElementById("custAdvance").value)||0,due:parseFloat(document.getElementById("custDue").value)||0};const arr=getArray(KEY_CUSTOMERS);arr.push(cust);setArray(KEY_CUSTOMERS,arr);document.getElementById("custResult").innerHTML='<div class="result-box">‚úî ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞: '+arr.length+'</div>';}
function saveLocal(){const id=document.getElementById("locId").value.trim();const name=document.getElementById("locName").value.trim();if(!id||!name){document.getElementById("locResult").innerHTML='<div class="result-box error">‚ö† ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ì ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const loc={id,name,mobile:document.getElementById("locMobile").value.trim(),address:document.getElementById("locAddress").value.trim(),photo:document.getElementById("locPhoto").value.trim(),advance:parseFloat(document.getElementById("locAdvance").value)||0,due:parseFloat(document.getElementById("locDue").value)||0};const arr=getArray(KEY_LOCALS);arr.push(loc);setArray(KEY_LOCALS,arr);document.getElementById("locResult").innerHTML='<div class="result-box">‚úî ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßã‡¶ü ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤: '+arr.length+'</div>';}
function saveSupplier(){const id=document.getElementById("supId").value.trim();const name=document.getElementById("supName").value.trim();if(!id||!name){document.getElementById("supResult").innerHTML='<div class="result-box error">‚ö† ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ì ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const sup={id,name,mobile:document.getElementById("supMobile").value.trim(),note:document.getElementById("supNote").value.trim()};const arr=getArray(KEY_SUPPLIERS);arr.push(sup);setArray(KEY_SUPPLIERS,arr);document.getElementById("supResult").innerHTML='<div class="result-box">‚úî ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßã‡¶ü ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞: '+arr.length+'</div>';}
function updateStockGram(){const v=parseFloat(document.getElementById("stVori").value)||0;const a=parseFloat(document.getElementById("stAna").value)||0;const r=parseFloat(document.getElementById("stRoti").value)||0;const p=parseFloat(document.getElementById("stPoint").value)||0;const g=parseFloat(document.getElementById("stGram").value)||0;const total=convertToGram(v,a,r,p,g);const el=document.getElementById("stGramTotal");if(el){el.value=total?total.toFixed(3):"";}}
function saveStock(){const code=document.getElementById("stCode").value.trim();const name=document.getElementById("stName").value.trim();if(!code||!name){document.getElementById("stockResult").innerHTML='<div class="result-box error">‚ö† ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶ï‡ßã‡¶° ‡¶ì ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®‡•§</div>';return;}const v=parseFloat(document.getElementById("stVori").value)||0;const a=parseFloat(document.getElementById("stAna").value)||0;const r=parseFloat(document.getElementById("stRoti").value)||0;const p=parseFloat(document.getElementById("stPoint").value)||0;const gDirect=parseFloat(document.getElementById("stGram").value)||0;const totalGram=convertToGram(v,a,r,p,gDirect);const item={code,name,barcode:document.getElementById("stBarcode").value.trim(),karat:document.getElementById("stKarat").value.trim(),vori:v,ana:a,roti:r,point:p,gramDirect:gDirect,gram:totalGram,supplierId:document.getElementById("stSupId").value.trim()};const arr=getArray(KEY_STOCK);arr.push(item);setArray(KEY_STOCK,arr);document.getElementById("stockResult").innerHTML='<div class="result-box">‚úî ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ: '+arr.length+'<br>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: '+totalGram.toFixed(3)+'</div>';['stVori','stAna','stRoti','stPoint','stGram','stGramTotal','stBarcode'].forEach(id=>{const el=document.getElementById(id);if(el)el.value="";});updateSummary();renderLastStock();}
function updateSummary(){const sales=getArray(KEY_SALES);const mortgages=getArray(KEY_MORTGAGE);const cashList=getArray(KEY_CASH);const stockList=getArray(KEY_STOCK);let sumSale=0;sales.forEach(s=>{if(s.type==='‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø'&&isToday(s.ts)){sumSale+=(s.net||0);}});let sumMortIn=0;let sumMortMonthly=0;mortgages.forEach(m=>{if(m.status!=='Closed'){sumMortIn+=(m.loan||0);sumMortMonthly+=(m.monthlyTotal||0);}});let sumCash=0;cashList.forEach(c=>sumCash+=(c.cin||0)-(c.cout||0));document.getElementById("sumSale").textContent=formatCurrency(sumSale);document.getElementById("sumMortIn").textContent=formatCurrency(sumMortIn);document.getElementById("sumMortMonthly").textContent=formatCurrency(sumMortMonthly);document.getElementById("sumCash").textContent=formatCurrency(sumCash);document.getElementById("sumStock").textContent=stockList.length.toString();}
function renderLastSales(){const el=document.getElementById("saleLast");const arr=getArray(KEY_SALES);if(!el)return;if(arr.length===0){el.innerHTML='';return;}const last=arr.slice(-5).reverse();let html='<b>‡¶∂‡ßá‡¶∑ ‡ß´ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø/‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞:</b><br>';last.forEach(s=>{const d=new Date(s.ts);html+=d.toLocaleDateString()+' - '+(s.billNo||'')+' - '+(s.customer||'')+' ('+s.type+') - '+formatCurrency(s.net||0)+'<br>';});el.innerHTML=html;}
function renderLastMortgages(){const el=document.getElementById("mortgageLast");const arr=getArray(KEY_MORTGAGE);if(!el)return;if(arr.length===0){el.innerHTML='';return;}const last=arr.slice(-5).reverse();let html='<b>‡¶∂‡ßá‡¶∑ ‡ß´ ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú:</b><br>';last.forEach(m=>{const d=new Date(m.ts);html+=d.toLocaleDateString()+' - '+(m.slip||'')+' - '+(m.customer||'')+' ['+(m.status||'')+'] - '+formatCurrency(m.loan||0)+' | ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï: '+formatCurrency(m.monthlyTotal||0)+'<br>';});el.innerHTML=html;}
function renderLastStock(){const el=document.getElementById("stockLast");const arr=getArray(KEY_STOCK);if(!el)return;if(arr.length===0){el.innerHTML='';return;}const last=arr.slice(-5).reverse();let html='<b>‡¶∂‡ßá‡¶∑ ‡ß´ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü:</b><br>';last.forEach(s=>{const g=parseFloat(s.gram)||0;html+=(s.code||'')+' - '+(s.name||'')+' ('+(s.karat||'')+') - '+g.toFixed(3)+' g';if(s.barcode){html+=' | ‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶°: '+s.barcode;}html+='<br>';});el.innerHTML=html;}
function exportData(){const data={sales:getArray(KEY_SALES),mortgages:getArray(KEY_MORTGAGE),cash:getArray(KEY_CASH),customers:getArray(KEY_CUSTOMERS),locals:getArray(KEY_LOCALS),suppliers:getArray(KEY_SUPPLIERS),stock:getArray(KEY_STOCK)};const text=JSON.stringify(data,null,2);const box=document.getElementById("exportBox");box.innerHTML='<b>‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßá‡¶≠ ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® (‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™):</b><br><textarea style="width:100%;height:140px;background:#020617;color:#e5e7eb;border-radius:10px;border:1px solid rgba(148,163,184,0.6);padding:6px;font-size:11px;">'+text+'</textarea>';}
function resetAll(){if(!confirm('‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá, ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?'))return;[KEY_SALES,KEY_MORTGAGE,KEY_CASH,KEY_CUSTOMERS,KEY_SUPPLIERS,KEY_STOCK,KEY_LOCALS,KEY_BILL_COUNTER].forEach(k=>localStorage.removeItem(k));updateSummary();renderLastSales();renderLastMortgages();renderLastStock();document.getElementById("exportBox").innerHTML='';alert('‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');}
function renderReport(){const rangeEl=document.getElementById("repRange");const range=rangeEl?rangeEl.value:'today';const onlyToday=(range==='today');const sales=getArray(KEY_SALES).filter(s=>!onlyToday||isToday(s.ts));const mortgages=getArray(KEY_MORTGAGE).filter(m=>!onlyToday||isToday(m.ts));const cash=getArray(KEY_CASH).filter(c=>!onlyToday||isToday(c.ts));const stock=getArray(KEY_STOCK);let sumSaleNet=0;let sumSaleQty=0;sales.forEach(s=>{if(s.type==='‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø')sumSaleNet+=(s.net||0);sumSaleQty+=1;});let htmlSales='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span><span>'+sumSaleQty+'</span></div>';htmlSales+='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶ü</span><span>'+formatCurrency(sumSaleNet)+'</span></div>';htmlSales+='<table class="rep-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶¨‡¶ø‡¶≤</th><th>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</th><th>‡¶ü‡¶æ‡¶á‡¶™</th><th>‡¶®‡ßá‡¶ü</th></tr></thead><tbody>';sales.slice(-50).reverse().forEach(s=>{const d=new Date(s.ts);htmlSales+='<tr><td>'+d.toLocaleDateString()+'</td><td>'+(s.billNo||'')+'</td><td>'+(s.customer||'')+'</td><td>'+s.type+'</td><td>'+formatCurrency(s.net||0)+'</td></tr>';});htmlSales+='</tbody></table>';document.getElementById("repSales").innerHTML=htmlSales;let sumLoan=0;let sumMonthly=0;mortgages.forEach(m=>{sumLoan+=(m.loan||0);sumMonthly+=(m.monthlyTotal||0);});let htmlMort='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span><span>'+mortgages.length+'</span></div>';htmlMort+='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶ã‡¶£</span><span>'+formatCurrency(sumLoan)+'</span></div>';htmlMort+='<div class="summary-row"><span>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Æ‡ßã‡¶ü (‡¶∏‡ßÅ‡¶¶+‡¶≤‡¶ï‡¶æ‡¶∞)</span><span>'+formatCurrency(sumMonthly)+'</span></div>';htmlMort+='<table class="rep-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶∏‡ßç‡¶≤‡¶ø‡¶™</th><th>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶≤‡ßã‡¶®</th><th>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</th></tr></thead><tbody>';mortgages.slice(-50).reverse().forEach(m=>{const d=new Date(m.ts);htmlMort+='<tr><td>'+d.toLocaleDateString()+'</td><td>'+(m.slip||'')+'</td><td>'+(m.customer||'')+'</td><td>'+(m.status||'')+'</td><td>'+formatCurrency(m.loan||0)+'</td><td>'+formatCurrency(m.monthlyTotal||0)+'</td></tr>';});htmlMort+='</tbody></table>';document.getElementById("repMort").innerHTML=htmlMort;let sumIn=0;let sumOut=0;cash.forEach(c=>{sumIn+=(c.cin||0);sumOut+=(c.cout||0);});let htmlCash='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span><span>'+cash.length+'</span></div>';htmlCash+='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü Cash In</span><span>'+formatCurrency(sumIn)+'</span></div>';htmlCash+='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü Cash Out</span><span>'+formatCurrency(sumOut)+'</span></div>';htmlCash+='<div class="summary-row"><span>‡¶®‡ßá‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂</span><span>'+formatCurrency(sumIn-sumOut)+'</span></div>';htmlCash+='<table class="rep-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ü‡¶æ‡¶á‡¶™</th><th>In</th><th>Out</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th></tr></thead><tbody>';cash.slice(-50).reverse().forEach(c=>{const d=new Date(c.ts);htmlCash+='<tr><td>'+d.toLocaleDateString()+'</td><td>'+c.type+'</td><td>'+formatCurrency(c.cin||0)+'</td><td>'+formatCurrency(c.cout||0)+'</td><td>'+(c.desc||'')+'</td></tr>';});htmlCash+='</tbody></table>';document.getElementById("repCash").innerHTML=htmlCash;let sumStockItems=stock.length;let sumStockGram=0;stock.forEach(s=>sumStockGram+=(parseFloat(s.gram)||0));let htmlStock='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ</span><span>'+sumStockItems+'</span></div>';htmlStock+='<div class="summary-row"><span>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï (‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ)</span><span>'+sumStockGram.toFixed(3)+' g</span></div>';htmlStock+='<table class="rep-table"><thead><tr><th>‡¶ï‡ßã‡¶°</th><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶ï‡¶æ‡¶∞‡ßá‡¶ü</th><th>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</th><th>‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶°</th></tr></thead><tbody>';stock.slice(-100).forEach(s=>{const g=parseFloat(s.gram)||0;htmlStock+='<tr><td>'+(s.code||'')+'</td><td>'+(s.name||'')+'</td><td>'+(s.karat||'')+'</td><td>'+g.toFixed(3)+'</td><td>'+(s.barcode||'')+'</td></tr>';});htmlStock+='</tbody></table>';document.getElementById("repStock").innerHTML=htmlStock;}
function loadLedger(){const cid=(document.getElementById('ledCustId').value||'').trim();const box=document.getElementById('ledgerBox');if(!cid){box.innerHTML='<span style="color:#fecaca;">‚ö† ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</span>';return;}const customers=getArray(KEY_CUSTOMERS);const cust=customers.find(c=>(c.id||'').toLowerCase()===cid.toLowerCase());const sales=getArray(KEY_SALES).filter(s=>(s.customerId||'').toLowerCase()===cid.toLowerCase());const mortgages=getArray(KEY_MORTGAGE).filter(m=>(m.customerId||'').toLowerCase()===cid.toLowerCase());if(!cust&&sales.length===0&&mortgages.length===0){box.innerHTML='<span style="color:#fecaca;">‡¶è‡¶á ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</span>';return;}let openingAdvance=cust?(cust.advance||0):0;let openingDue=cust?(cust.due||0):0;let totalNet=0;let totalPaid=0;let totalDue=0;sales.forEach(s=>{if(s.type==='‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø'){totalNet+=(s.net||0);totalPaid+=(s.paid||0);totalDue+=(s.due||0);}});let html='';html+='<b>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø:</b> '+cid+'<br>';if(cust){html+='<b>‡¶®‡¶æ‡¶Æ:</b> '+(cust.name||'')+' | ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: '+(cust.mobile||'')+'<br>';}html+='<br><b>‡¶ì‡¶™‡ßá‡¶®‡¶ø‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏:</b> ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ = '+formatCurrency(openingAdvance)+' | ‡¶¨‡¶æ‡¶ï‡¶ø = '+formatCurrency(openingDue)+'<br><br>';html+='<b>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂:</b><br>';html+='‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶ü: '+formatCurrency(totalNet)+' | ‡¶Æ‡ßã‡¶ü ‡¶®‡¶ó‡¶¶: '+formatCurrency(totalPaid)+' | ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø: '+formatCurrency(totalDue)+'<br><br>';if(sales.length>0){html+='<table class="rep-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶¨‡¶ø‡¶≤</th><th>‡¶ü‡¶æ‡¶á‡¶™</th><th>‡¶®‡ßá‡¶ü</th><th>‡¶®‡¶ó‡¶¶</th><th>‡¶¨‡¶æ‡¶ï‡¶ø</th></tr></thead><tbody>';sales.slice(-100).reverse().forEach(s=>{const d=new Date(s.ts);html+='<tr><td>'+d.toLocaleDateString()+'</td><td>'+(s.billNo||'')+'</td><td>'+s.type+'</td><td>'+formatCurrency(s.net||0)+'</td><td>'+formatCurrency(s.paid||0)+'</td><td>'+formatCurrency(s.due||0)+'</td></tr>';});html+='</tbody></table><br>';}else{html+='‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§<br><br>';}if(mortgages.length>0){html+='<b>‡¶Æ‡¶∞‡ßç‡¶ü‡¶ó‡ßá‡¶ú ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂:</b><br>';let sumLoan=0;let sumMonthly=0;mortgages.forEach(m=>{sumLoan+=(m.loan||0);sumMonthly+=(m.monthlyTotal||0);});html+='‡¶Æ‡ßã‡¶ü Loan: '+formatCurrency(sumLoan)+' | ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Æ‡ßã‡¶ü (‡¶∏‡ßÅ‡¶¶+‡¶≤‡¶ï‡¶æ‡¶∞): '+formatCurrency(sumMonthly)+'<br>';html+='<table class="rep-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶∏‡ßç‡¶≤‡¶ø‡¶™</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>Loan</th><th>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</th></tr></thead><tbody>';mortgages.slice(-50).reverse().forEach(m=>{const d=new Date(m.ts);html+='<tr><td>'+d.toLocaleDateString()+'</td><td>'+(m.slip||'')+'</td><td>'+(m.status||'')+'</td><td>'+formatCurrency(m.loan||0)+'</td><td>'+formatCurrency(m.monthlyTotal||0)+'</td></tr>';});html+='</tbody></table>';}box.innerHTML=html;}
</script>
</body>
</html>
